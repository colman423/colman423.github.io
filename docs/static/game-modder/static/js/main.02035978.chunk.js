(window["webpackJsonparcade-share"]=window["webpackJsonparcade-share"]||[]).push([[0],[,,,,,,,,,,,function(t,e,i){},,function(t,e,i){t.exports=i(29)},,,,,function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){},,function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){"use strict";i.r(e);var n,a=i(1),s=i.n(a),o=i(12),r=i.n(o),c=(i(18),i(0)),h=i(2),u=i(4),l=i(3),d=i(9),f=i(5),v=(i(19),i(20),function(t){return s.a.createElement("div",{className:"game-embed"},s.a.createElement("iframe",{ref:function(e){return t.simulator.setFrame(e)},className:"game-embed-frame",title:"MakeCode Arcade Simulator",allow:"autoplay",sandbox:"allow-same-origin allow-scripts"}))});!function(t){t[t.A=0]="A",t[t.B=1]="B",t[t.Up=2]="Up",t[t.Down=3]="Down",t[t.Left=4]="Left",t[t.Right=5]="Right",t[t.Menu=6]="Menu",t[t.Reset=7]="Reset"}(n||(n={}));var p=function(){function t(e){var i=this;Object(c.a)(this,t),this.frame=void 0,this.buttonState=[],this.changeListeners=[],this.framePromise=void 0,this.readyPromise=void 0,this.lastRunBinary=void 0,this.messageHandler=function(t){var e=t.data;i.handleMessage(e)},this.frame=e,window.addEventListener("message",this.messageHandler)}return Object(h.a)(t,[{key:"setFrame",value:function(t){t&&(this.frame=t,this.framePromise&&this.framePromise.resolve())}},{key:"pressButton",value:function(t){this.buttonState[t]||this.sendButtonState(t,!0)}},{key:"releaseButton",value:function(t){this.buttonState[t]&&this.sendButtonState(t,!1)}},{key:"isPressed",value:function(t){return!!this.buttonState[t]}},{key:"addChangeListener",value:function(t){-1===this.changeListeners.indexOf(t)&&this.changeListeners.push(t)}},{key:"removeChangeListener",value:function(t){var e=this.changeListeners.indexOf(t);-1!==e&&this.changeListeners.splice(e,1)}},{key:"runCode",value:function(t){var e=this;this.lastRunBinary=t,this.waitForSimFrameAsync().then(function(){e.readyPromise=void 0;var i="sim-frame-".concat(1e6*Math.random());e.frame.setAttribute("id",i),e.frame.src="".concat("http://localhost:3232","/sim/simulator.html?justscreen=1&run=").concat(i,"#").concat(i),e.waitForSimReadyAsync().then(function(){e.sendMessage({type:"run",code:t})})})}},{key:"dispose",value:function(){window.removeEventListener("message",this.messageHandler)}},{key:"sendButtonState",value:function(t,e){this.updateButtonState(t,e),this.sendMessage({type:"button-pressed",button:t,pressed:e})}},{key:"updateButtonState",value:function(t,e){!!this.buttonState[t]!==e&&(this.buttonState[t]=e,this.changeListeners.forEach(function(i){return i(t,e)}))}},{key:"sendMessage",value:function(t){this.frame&&this.frame.contentWindow&&this.frame.contentWindow.postMessage(t,"*")}},{key:"handleMessage",value:function(t){switch(t.type){case"ready":this.readyPromise&&this.readyPromise.resolve();break;case"simulator":"restart"===t.command&&this.runCode(this.lastRunBinary)}}},{key:"waitForSimFrameAsync",value:function(){return this.frame?Promise.resolve():this.framePromise?this.framePromise.promise:(this.framePromise=new y,this.framePromise.promise)}},{key:"waitForSimReadyAsync",value:function(){return this.readyPromise?this.readyPromise.promise:(this.readyPromise=new y,this.readyPromise.promise)}}]),t}(),y=function(){function t(){var e=this;Object(c.a)(this,t),this.promise=void 0,this._resolve=void 0,this._reject=void 0,this.promise=new Promise(function(t,i){e._resolve=t,e._reject=i})}return Object(h.a)(t,[{key:"resolve",value:function(){this._resolve&&this._resolve(),this._resolve=void 0,this._reject=void 0}},{key:"reject",value:function(){this._reject&&this._reject(),this._resolve=void 0,this._reject=void 0}},{key:"isFinished",value:function(){return!this._resolve}}]),t}(),g=(i(21),40),m=g>>1;function b(t,e){for(var i=0;i<t.changedTouches.length;i++)if(t.changedTouches[i].identifier===e)return t.changedTouches[i]}var k=function(t){function e(){var t,i;Object(c.a)(this,e);for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return(i=Object(u.a)(this,(t=Object(l.a)(e)).call.apply(t,[this].concat(s)))).dPadUp=void 0,i.dPadDown=void 0,i.dPadLeft=void 0,i.dPadRight=void 0,i.joystickHandle=void 0,i.joystickAnimation=void 0,i.handleX=g>>1,i.handleY=g>>1,i.lastOctet=void 0,i.buttonChangeListener=function(t,e){switch(t){case n.Down:i.updateDirection(i.dPadDown,e);break;case n.Up:i.updateDirection(i.dPadUp,e);break;case n.Left:i.updateDirection(i.dPadLeft,e);break;case n.Right:i.updateDirection(i.dPadRight,e)}},i}return Object(f.a)(e,t),Object(h.a)(e,[{key:"componentDidMount",value:function(){this.dPadUp=this.refs["dpad-up"],this.dPadDown=this.refs["dpad-down"],this.dPadLeft=this.refs["dpad-left"],this.dPadRight=this.refs["dpad-right"],this.joystickHandle=this.refs["joystick-handle"],this.bindEvents(this.refs["joystick-bounds"]),this.props.simulator.addChangeListener(this.buttonChangeListener)}},{key:"componentWillUnmount",value:function(){this.dPadUp=void 0,this.dPadDown=void 0,this.dPadLeft=void 0,this.dPadRight=void 0,this.joystickHandle=void 0,this.props.simulator.removeChangeListener(this.buttonChangeListener)}},{key:"render",value:function(){var t=this.props.changeMode;return s.a.createElement("div",{ref:"joystick-container",className:"game-joystick"},s.a.createElement("div",{className:"spacer"}),s.a.createElement("div",{className:"action-button"},s.a.createElement("button",{className:"share-mod-button",onClick:function(){return t("mod")}},"Mod")),s.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",ref:"joystick-bounds",className:"game-joystick-svg",viewBox:"1 0 40 40",width:"200px",height:"200px"},s.a.createElement("circle",{id:"joystick-background",cx:"20",cy:"20",r:"16",fill:"#397382",stroke:"#397382",strokeWidth:"2"}),s.a.createElement("rect",{ref:"dpad-up",x:"16",y:"6",width:"8",height:"12",rx:"2",fill:"#cecece",stroke:"none",strokeWidth:"1"}),s.a.createElement("rect",{ref:"dpad-down",x:"16",y:"22",width:"8",height:"12",rx:"2",fill:"#cecece",stroke:"none",strokeWidth:"1"}),s.a.createElement("rect",{ref:"dpad-right",x:"22",y:"16",width:"12",height:"8",ry:"2",fill:"#cecece",stroke:"none",strokeWidth:"1"}),s.a.createElement("rect",{ref:"dpad-left",x:"6",y:"16",width:"12",height:"8",ry:"2",fill:"#cecece",stroke:"none",strokeWidth:"1"}),s.a.createElement("circle",{cx:"20",cy:"20",r:"6",fill:"#cecece"}),s.a.createElement("circle",{ref:"joystick-handle",cx:"20",cy:"20",r:"6",fill:"#333",stroke:"#999",strokeWidth:"2"})))}},{key:"updateDirection",value:function(t,e){t&&t.setAttribute("fill",e?"#249ca3":"#cecece")}},{key:"bindEvents",value:function(t){t&&("undefined"!=typeof window&&window.PointerEvent?this.bindPointerEvents(t):"undefined"!==typeof window&&("ontouchstart"in window||navigator&&navigator.maxTouchPoints>0)?this.bindTouchEvents(t):this.bindMouseEvents(t))}},{key:"bindPointerEvents",value:function(t){var e=this,i=!1;t.addEventListener("pointerup",function(t){i&&(e.updateJoystickDrag(t.clientX,t.clientY),e.startAnimation()),i=!1}),t.addEventListener("pointerdown",function(t){e.updateJoystickDrag(t.clientX,t.clientY),i=!0}),t.addEventListener("pointermove",function(t){i&&e.updateJoystickDrag(t.clientX,t.clientY)}),t.addEventListener("pointerleave",function(t){i&&(e.updateJoystickDrag(t.clientX,t.clientY),e.startAnimation()),i=!1})}},{key:"bindMouseEvents",value:function(t){var e=this,i=!1;t.addEventListener("mouseup",function(t){i&&(e.updateJoystickDrag(t.clientX,t.clientY),e.startAnimation()),i=!1}),t.addEventListener("mousedown",function(t){e.updateJoystickDrag(t.clientX,t.clientY),i=!0}),t.addEventListener("mousemove",function(t){i&&e.updateJoystickDrag(t.clientX,t.clientY)}),t.addEventListener("mouseleave",function(t){i&&(e.updateJoystickDrag(t.clientX,t.clientY),e.startAnimation()),i=!1})}},{key:"bindTouchEvents",value:function(t){var e,i=this;t.addEventListener("touchend",function(t){if(e){var n=b(t,e);n&&(i.updateJoystickDrag(n.clientX,n.clientY),i.startAnimation(),t.preventDefault())}e=void 0}),t.addEventListener("touchstart",function(t){e=t.changedTouches[0].identifier,i.updateJoystickDrag(t.changedTouches[0].clientX,t.changedTouches[0].clientY)}),t.addEventListener("touchmove",function(t){if(e){var n=b(t,e);n&&(i.updateJoystickDrag(n.clientX,n.clientY),t.preventDefault())}}),t.addEventListener("touchcancel",function(t){if(e){var n=b(t,e);n&&(i.updateJoystickDrag(n.clientX,n.clientY),i.startAnimation())}e=void 0})}},{key:"updateJoystickDrag",value:function(t,e){if(this.joystickHandle){var i=this.refs["joystick-bounds"].getBoundingClientRect(),n=(t-i.left)*(g/i.width)-m,a=(e-i.top)*(g/i.height)-m,s=Math.atan2(a,n),o=Math.min(Math.sqrt(Math.pow(n,2)+Math.pow(a,2)),10);this.setHandlePosition(m+o*Math.cos(s),m+o*Math.sin(s))}}},{key:"startAnimation",value:function(){var t=this;if(this.clearButtonPresses(),this.joystickHandle){this.stopAnimation();this.joystickAnimation=requestAnimationFrame(function e(){var i=t.getHandleDistance();if(i<.5)t.setHandlePosition(m,m,!0),t.stopAnimation();else{var n=t.getHandleAngle();i=Math.max(i-1,0),t.setHandlePosition(m+i*Math.cos(n),m+i*Math.sin(n),!0),t.joystickAnimation=requestAnimationFrame(e)}})}}},{key:"stopAnimation",value:function(){this.joystickAnimation&&(cancelAnimationFrame(this.joystickAnimation),this.joystickAnimation=void 0)}},{key:"setHandlePosition",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.joystickHandle&&(this.joystickHandle.setAttribute("cx",""+t),this.joystickHandle.setAttribute("cy",""+e),this.handleX=t,this.handleY=e,!i))if(this.getHandleDistance()<5)this.clearButtonPresses();else{var a=this.props.simulator,s=this.getHandleAngle(),o=(5+Math.floor(s/(Math.PI/4)-.5))%8;if(o===this.lastOctet)return;this.lastOctet=o;var r=!1,c=!1,h=!1,u=!1;switch(o){case 0:r=!0;break;case 1:r=!0,h=!0;break;case 2:h=!0;break;case 3:h=!0,c=!0;break;case 4:c=!0;break;case 5:c=!0,u=!0;break;case 6:u=!0;break;case 7:r=!0,u=!0}u?a.pressButton(n.Down):a.releaseButton(n.Down),h?a.pressButton(n.Up):a.releaseButton(n.Up),r?a.pressButton(n.Left):a.releaseButton(n.Left),c?a.pressButton(n.Right):a.releaseButton(n.Right)}}},{key:"getHandleAngle",value:function(){return Math.atan2(this.handleY-m,this.handleX-m)}},{key:"getHandleDistance",value:function(){return Math.sqrt(Math.pow(this.handleX-m,2)+Math.pow(this.handleY-m,2))}},{key:"clearButtonPresses",value:function(){var t=this.props.simulator;t.releaseButton(n.Down),t.releaseButton(n.Up),t.releaseButton(n.Left),t.releaseButton(n.Right),this.lastOctet=void 0}}]),e}(s.a.Component);i(22);function w(t,e){for(var i=0;i<t.changedTouches.length;i++)if(t.changedTouches[i].identifier===e)return t.changedTouches[i]}var E,C,A,O=function(t){function e(){var t,i;Object(c.a)(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(i=Object(u.a)(this,(t=Object(l.a)(e)).call.apply(t,[this].concat(a)))).aButton=void 0,i.aLabel=void 0,i.bButton=void 0,i.bLabel=void 0,i}return Object(f.a)(e,t),Object(h.a)(e,[{key:"componentDidMount",value:function(){this.aButton=this.refs["button-a"],this.aLabel=this.refs["label-a"],this.bButton=this.refs["button-b"],this.bLabel=this.refs["label-b"],this.bindEvents(this.refs["button-bounds"])}},{key:"componentWillUnmount",value:function(){this.aButton=void 0,this.aLabel=void 0,this.bButton=void 0,this.bLabel=void 0}},{key:"render",value:function(){var t=this.props.changeMode;return s.a.createElement("div",{className:"game-buttons"},s.a.createElement("div",{className:"spacer"}),s.a.createElement("div",{className:"action-button"},s.a.createElement("button",{className:"share-mod-button",onClick:function(){return t("share")}},"Share")),s.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",ref:"button-bounds",className:"game-button-svg",viewBox:"0 0 40 40",width:"200px",height:"200px"},s.a.createElement("circle",{ref:"button-b",cx:"13",cy:"28",r:"9",fill:"#333",stroke:"#397382",strokeWidth:"2.5"}),s.a.createElement("text",{ref:"label-b",x:"13",y:"28",textAnchor:"middle",dy:"2.5",fontSize:"8"},"B"),s.a.createElement("circle",{ref:"button-a",cx:"28",cy:"11",r:"9",fill:"#333",stroke:"#397382",strokeWidth:"2.5"}),s.a.createElement("text",{ref:"label-a",x:"28",y:"11",textAnchor:"middle",dy:"2.5",fontSize:"8"},"A")))}},{key:"updateButtonGesture",value:function(t,e){var i=this.refs["button-bounds"].getBoundingClientRect(),a=(t-i.left)*(40/i.width),s=(e-i.top)*(40/i.height),o=Math.sqrt(Math.pow(a-30,2)+Math.pow(s-13,2)),r=Math.sqrt(Math.pow(a-15,2)+Math.pow(s-28,2));this.setButtonState(n.A,o<8),this.setButtonState(n.B,r<8)}},{key:"clearButtonPresses",value:function(){this.setButtonState(n.A,!1),this.setButtonState(n.B,!1)}},{key:"setButtonState",value:function(t,e){var i=t===n.A,a=i?this.aButton:this.bButton,s=i?this.aLabel:this.bLabel;if(a&&s){a.setAttribute("fill",e?"#249ca3":"#333"),s.setAttribute("fill",e?"#333":"")}var o=this.props.simulator;e?o.pressButton(t):o.releaseButton(t)}},{key:"bindEvents",value:function(t){t&&("undefined"!=typeof window&&window.PointerEvent?this.bindPointerEvents(t):"undefined"!==typeof window&&("ontouchstart"in window||navigator&&navigator.maxTouchPoints>0)?this.bindTouchEvents(t):this.bindMouseEvents(t))}},{key:"bindPointerEvents",value:function(t){var e=this,i=!1;t.addEventListener("pointerup",function(t){i&&e.clearButtonPresses(),i=!1}),t.addEventListener("pointerdown",function(t){e.updateButtonGesture(t.clientX,t.clientY),i=!0}),t.addEventListener("pointermove",function(t){i&&e.updateButtonGesture(t.clientX,t.clientY)}),t.addEventListener("pointerleave",function(t){i&&e.clearButtonPresses(),i=!1})}},{key:"bindMouseEvents",value:function(t){var e=this,i=!1;t.addEventListener("mouseup",function(t){i&&e.clearButtonPresses(),i=!1}),t.addEventListener("mousedown",function(t){e.updateButtonGesture(t.clientX,t.clientY),i=!0}),t.addEventListener("mousemove",function(t){i&&e.updateButtonGesture(t.clientX,t.clientY)}),t.addEventListener("mouseleave",function(t){i&&e.clearButtonPresses(),i=!1})}},{key:"bindTouchEvents",value:function(t){var e,i=this;t.addEventListener("touchend",function(t){e&&(w(t,e)&&(i.clearButtonPresses(),t.preventDefault()));e=void 0}),t.addEventListener("touchstart",function(t){e=t.changedTouches[0].identifier,i.updateButtonGesture(t.changedTouches[0].clientX,t.changedTouches[0].clientY)}),t.addEventListener("touchmove",function(t){if(e){var n=w(t,e);n&&(i.updateButtonGesture(n.clientX,n.clientY),t.preventDefault())}}),t.addEventListener("touchcancel",function(t){e&&(w(t,e)&&i.clearButtonPresses());e=void 0})}}]),e}(s.a.Component),j=(i(23),function(t){return E||(E=new p),E.runCode(t.binJs),s.a.createElement("div",{className:"game-player"},s.a.createElement(k,{simulator:E,changeMode:t.changeMode}),s.a.createElement(v,{simulator:E}),s.a.createElement(O,{simulator:E,changeMode:t.changeMode}),s.a.createElement("div",{className:"game-player-background"}),s.a.createElement("div",{className:"game-player-logo"},"MAKECODE"),s.a.createElement("div",{className:"game-player-msft"}),s.a.createElement("div",{className:"game-player-vent"}))}),x=i(6),L=i.n(x),S=i(7);function T(){return"undefined"!==typeof window&&("ontouchstart"in window||navigator&&navigator.maxTouchPoints>0)}function B(){return"undefined"!=typeof window&&!!window.PointerEvent}!function(t){t[t.userSpaceOnUse=0]="userSpaceOnUse",t[t.objectBoundingBox=1]="objectBoundingBox"}(C||(C={})),function(t){t[t.em=0]="em",t[t.ex=1]="ex",t[t.px=2]="px",t[t.in=3]="in",t[t.cm=4]="cm",t[t.mm=5]="mm",t[t.pt=6]="pt",t[t.pc=7]="pc",t[t.percent=8]="percent"}(A||(A={}));var D=function(){function t(e){Object(c.a)(this,t),this.el=void 0,this.titleElement=void 0,this.el=Z(e)}return Object(h.a)(t,[{key:"attr",value:function(t){var e=this;return Object.keys(t).forEach(function(i){e.setAttribute(i,t[i])}),this}},{key:"setAttribute",value:function(t,e){return this.el.setAttribute(t,e.toString()),this}},{key:"setAttributeNS",value:function(t,e,i){return this.el.setAttributeNS(t,e,i.toString()),this}},{key:"id",value:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){return this.setAttribute("id",t)})},{key:"setClass",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.setAttribute("class",e.join(" "))}},{key:"addClassInternal",value:function(t,e){e.split(/\s+/).forEach(function(e){return function(t,e){if(t.classList)t.classList.add(e);else{(t.className+"").split(/\s+/).indexOf(e)<0&&(t.className.baseVal+=" "+e)}}(t,e)})}},{key:"removeClassInternal",value:function(t,e){e.split(/\s+/).forEach(function(e){return function(t,e){t.classList?t.classList.remove(e):t.className.baseVal=(t.className+"").split(/\s+/).filter(function(t){return t!=e}).join(" ")}(t,e)})}},{key:"appendClass",value:function(t){return this.addClassInternal(this.el,t),this}},{key:"removeClass",value:function(t){this.removeClassInternal(this.el,t)}},{key:"title",value:function(t){this.titleElement||(this.titleElement=Z("title"),this.el.firstChild?this.el.insertBefore(this.titleElement,this.el.firstChild):this.el.appendChild(this.titleElement)),this.titleElement.textContent=t}},{key:"setVisible",value:function(t){return this.setAttribute("visibility",t?"visible":"hidden")}}]),t}(),R=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(l.a)(e).apply(this,arguments))}return Object(f.a)(e,t),Object(h.a)(e,[{key:"draw",value:function(t){var e=function(t){switch(t){case"text":return new N;case"circle":return new F;case"rect":return new U;case"line":return new Y;case"polygon":return new G;case"polyline":return new z;case"path":return new J;default:return new q(t)}}(t);return this.el.appendChild(e.el),e}},{key:"element",value:function(t,e){return e(this.draw(t)),this}},{key:"group",value:function(){var t=new P;return this.el.appendChild(t.el),t}},{key:"appendChild",value:function(t){this.el.appendChild(t.el)}},{key:"onDown",value:function(t){return function(t,e){B()?t.addEventListener("pointerdown",e):T()?(t.addEventListener("mousedown",e),t.addEventListener("touchstart",e)):t.addEventListener("mousedown",e)}(this.el,t),this}},{key:"onUp",value:function(t){return function(t,e){B()?t.addEventListener("pointerup",e):(T(),t.addEventListener("mouseup",e))}(this.el,t),this}},{key:"onMove",value:function(t){return function(t,e){B()?t.addEventListener("pointermove",e):T()?t.addEventListener("touchmove",e):t.addEventListener("mousemove",e)}(this.el,t),this}},{key:"onEnter",value:function(t){return function(t,e){B()?t.addEventListener("pointerover",function(t){e(!!(1&t.buttons))}):T()?t.addEventListener("touchstart",function(t){e(!0)}):t.addEventListener("mouseover",function(t){e(!!(1&t.buttons))})}(this.el,t),this}},{key:"onLeave",value:function(t){return function(t,e){B()?t.addEventListener("pointerleave",e):T()?t.addEventListener("touchend",e):t.addEventListener("mouseleave",e)}(this.el,t),this}},{key:"onClick",value:function(t){return function(t,e){t.addEventListener("click",e)}(this.el,t),this}}]),e}(D),M=function(t){function e(t){var i;return Object(c.a)(this,e),(i=Object(u.a)(this,Object(l.a)(e).call(this,"svg"))).defs=void 0,t&&t.appendChild(i.el),i}return Object(f.a)(e,t),Object(h.a)(e,[{key:"define",value:function(t){return this.defs||(this.defs=new I(this.el)),t(this.defs),this}}]),e}(R),P=function(t){function e(t){var i;return Object(c.a)(this,e),(i=Object(u.a)(this,Object(l.a)(e).call(this,"g"))).top=void 0,i.left=void 0,i.scaleFactor=void 0,t&&t.appendChild(i.el),i}return Object(f.a)(e,t),Object(h.a)(e,[{key:"translate",value:function(t,e){return this.left=t,this.top=e,this.updateTransform()}},{key:"scale",value:function(t){return this.scaleFactor=t,this.updateTransform()}},{key:"def",value:function(){return new I(this.el)}},{key:"style",value:function(){return new W(this.el)}},{key:"updateTransform",value:function(){var t="";return void 0!=this.left&&(t+="translate(".concat(this.left," ").concat(this.top,")")),void 0!=this.scaleFactor&&(t+=" scale(".concat(this.scaleFactor,")")),this.setAttribute("transform",t),this}}]),e}(R),H=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(l.a)(e).call(this,"pattern"))}return Object(f.a)(e,t),Object(h.a)(e,[{key:"units",value:function(t){return this.setAttribute("patternUnits",t===C.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")}},{key:"contentUnits",value:function(t){return this.setAttribute("patternContentUnits",t===C.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")}},{key:"size",value:function(t,e){return this.setAttribute("width",t),this.setAttribute("height",e),this}}]),e}(R),I=function(t){function e(t){var i;return Object(c.a)(this,e),i=Object(u.a)(this,Object(l.a)(e).call(this,"defs")),t.appendChild(i.el),i}return Object(f.a)(e,t),Object(h.a)(e,[{key:"create",value:function(t,e){var i;switch(t){case"path":i=new J;break;case"pattern":i=new H;break;case"radialGradient":i=new Q;break;case"linearGradient":i=new V;break;case"clipPath":i=new _;break;default:i=new D(t)}return i.id(e),this.el.appendChild(i.el),i}}]),e}(D),W=function(t){function e(t){var i;return Object(c.a)(this,e),i=Object(u.a)(this,Object(l.a)(e).call(this,"style")),t.appendChild(i.el),i}return Object(f.a)(e,t),Object(h.a)(e,[{key:"content",value:function(t){this.el.textContent=t}}]),e}(D),q=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(l.a)(e).apply(this,arguments))}return Object(f.a)(e,t),Object(h.a)(e,[{key:"at",value:function(t,e){return this.setAttribute("x",t),this.setAttribute("y",e),this}},{key:"moveTo",value:function(t,e){return this.at(t,e)}},{key:"fill",value:function(t,e){return this.setAttribute("fill",t),void 0!=e&&this.opacity(e),this}},{key:"opacity",value:function(t){return this.setAttribute("fill-opacity",t)}},{key:"stroke",value:function(t,e){return this.setAttribute("stroke",t),void 0!=e&&this.strokeWidth(e),this}},{key:"strokeWidth",value:function(t){return this.setAttribute("stroke-width",t)}},{key:"strokeOpacity",value:function(t){return this.setAttribute("stroke-opacity",t)}},{key:"clipPath",value:function(t){return this.setAttribute("clip-path",t)}}]),e}(R),N=function(t){function e(t){var i;return Object(c.a)(this,e),i=Object(u.a)(this,Object(l.a)(e).call(this,"text")),void 0!=t&&i.text(t),i}return Object(f.a)(e,t),Object(h.a)(e,[{key:"text",value:function(t){return this.el.textContent=t,this}},{key:"fontFamily",value:function(t){return this.setAttribute("font-family",t)}},{key:"fontSize",value:function(t,e){return this.setAttribute("font-size",tt(t,e))}},{key:"offset",value:function(t,e,i){return 0!==t&&this.setAttribute("dx",tt(t,i)),0!==e&&this.setAttribute("dy",tt(e,i)),this}},{key:"anchor",value:function(t){return this.setAttribute("text-anchor",t)}}]),e}(q),U=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(l.a)(e).call(this,"rect"))}return Object(f.a)(e,t),Object(h.a)(e,[{key:"width",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A.px;return this.setAttribute("width",tt(t,e))}},{key:"height",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A.px;return this.setAttribute("height",tt(t,e))}},{key:"corner",value:function(t){return this.corners(t,t)}},{key:"corners",value:function(t,e){return this.setAttribute("rx",t),this.setAttribute("ry",e),this}},{key:"size",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.px;return this.width(t,i),this.height(e,i),this}}]),e}(q),F=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(l.a)(e).call(this,"circle"))}return Object(f.a)(e,t),Object(h.a)(e,[{key:"at",value:function(t,e){return this.setAttribute("cx",t),this.setAttribute("cy",e),this}},{key:"radius",value:function(t){return this.setAttribute("r",t)}}]),e}(q),Y=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(l.a)(e).call(this,"line"))}return Object(f.a)(e,t),Object(h.a)(e,[{key:"at",value:function(t,e,i,n){return this.from(t,e),void 0!=i&&void 0!=n&&this.to(i,n),this}},{key:"from",value:function(t,e){return this.setAttribute("x1",t),this.setAttribute("y1",e),this}},{key:"to",value:function(t,e){return this.setAttribute("x2",t),this.setAttribute("y2",e),this}}]),e}(q),X=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(l.a)(e).apply(this,arguments))}return Object(f.a)(e,t),Object(h.a)(e,[{key:"points",value:function(t){return this.setAttribute("points",t)}},{key:"with",value:function(t){return this.points(t.map(function(t){return t.x+" "+t.y}).join(","))}}]),e}(q),z=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(l.a)(e).call(this,"polyline"))}return Object(f.a)(e,t),e}(X),G=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(l.a)(e).call(this,"polygon"))}return Object(f.a)(e,t),e}(X),J=function(t){function e(){var t;return Object(c.a)(this,e),(t=Object(u.a)(this,Object(l.a)(e).call(this,"path"))).d=void 0,t.d=new $,t}return Object(f.a)(e,t),Object(h.a)(e,[{key:"update",value:function(){return this.setAttribute("d",this.d.toAttribute())}},{key:"path",value:function(t){return t(this.d),this.update()}}]),e}(q),K=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(l.a)(e).apply(this,arguments))}return Object(f.a)(e,t),Object(h.a)(e,[{key:"units",value:function(t){return this.setAttribute("gradientUnits",t===C.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")}},{key:"stop",value:function(t,e,i){var n=Z("stop");return n.setAttribute("offset",t+"%"),void 0!=e&&n.setAttribute("stop-color",e),void 0!=i&&n.setAttribute("stop-opacity",i),this.el.appendChild(n),this}}]),e}(D),V=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(l.a)(e).call(this,"linearGradient"))}return Object(f.a)(e,t),Object(h.a)(e,[{key:"start",value:function(t,e){return this.setAttribute("x1",t),this.setAttribute("y1",e),this}},{key:"end",value:function(t,e){return this.setAttribute("x2",t),this.setAttribute("y2",e),this}}]),e}(K),Q=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(l.a)(e).call(this,"radialGradient"))}return Object(f.a)(e,t),Object(h.a)(e,[{key:"center",value:function(t,e){return this.setAttribute("cx",t),this.setAttribute("cy",e),this}},{key:"focus",value:function(t,e,i){return this.setAttribute("fx",t),this.setAttribute("fy",e),this.setAttribute("fr",i),this}},{key:"radius",value:function(t){return this.setAttribute("r",t)}}]),e}(K),_=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(l.a)(e).call(this,"clipPath"))}return Object(f.a)(e,t),Object(h.a)(e,[{key:"clipPathUnits",value:function(t){return t?this.setAttribute("clipPathUnits","objectBoundingBox"):this.setAttribute("clipPathUnits","userSpaceOnUse")}}]),e}(R);function Z(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}var $=function(){function t(){Object(c.a)(this,t),this.ops=[]}return Object(h.a)(t,[{key:"clear",value:function(){this.ops=[]}},{key:"moveTo",value:function(t,e){return this.op("M",t,e)}},{key:"moveBy",value:function(t,e){return this.op("m",t,e)}},{key:"lineTo",value:function(t,e){return this.op("L",t,e)}},{key:"lineBy",value:function(t,e){return this.op("l",t,e)}},{key:"cCurveTo",value:function(t,e,i,n,a,s){return this.op("C",t,e,i,n,a,s)}},{key:"cCurveBy",value:function(t,e,i,n,a,s){return this.op("c",t,e,i,n,a,s)}},{key:"qCurveTo",value:function(t,e,i,n){return this.op("Q",t,e,i,n)}},{key:"qCurveBy",value:function(t,e,i,n){return this.op("q",t,e,i,n)}},{key:"sCurveTo",value:function(t,e,i,n){return this.op("S",t,e,i,n)}},{key:"sCurveBy",value:function(t,e,i,n){return this.op("s",t,e,i,n)}},{key:"tCurveTo",value:function(t,e){return this.op("T",t,e)}},{key:"tCurveBy",value:function(t,e){return this.op("t",t,e)}},{key:"arcTo",value:function(t,e,i,n,a,s,o){return this.op("A",t,e,i,n?1:0,a?1:0,s,o)}},{key:"arcBy",value:function(t,e,i,n,a,s,o){return this.op("a",t,e,i,n?1:0,a?1:0,s,o)}},{key:"close",value:function(){return this.op("z")}},{key:"toAttribute",value:function(){return this.ops.map(function(t){return t.op+" "+t.args.join(" ")}).join(" ")}},{key:"op",value:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return this.ops.push({op:t,args:i}),this}}]),t}();function tt(t,e){switch(e){case A.em:return t+"em";case A.ex:return t+"ex";case A.px:return t+"px";case A.in:return t+"in";case A.cm:return t+"cm";case A.mm:return t+"mm";case A.pt:return t+"pt";case A.pc:return t+"pc";case A.percent:return t+"%";default:return t.toString()}}var et;function it(){return"undefined"!=typeof window&&!!window.PointerEvent}function nt(){return"undefined"!==typeof window&&("ontouchstart"in window||navigator&&navigator.maxTouchPoints>0)}!function(t){t[t.Pan=0]="Pan",t[t.Stamp=1]="Stamp",t[t.Erase=2]="Erase"}(et||(et={}));var at=function(){function t(e,i){Object(c.a)(this,t),this.width=e,this.height=i,this.mask=void 0,this.mask=new Uint8Array(Math.ceil(e*i/8))}return Object(h.a)(t,[{key:"set",value:function(t,e){var i=t+this.width*e,n=i>>3,a=7&i;this.mask[n]|=1<<a}},{key:"get",value:function(t,e){var i=t+this.width*e,n=i>>3,a=7&i;return this.mask[n]>>a&1}}]),t}(),st=it()?{up:"pointerup",down:["pointerdown"],move:"pointermove",enter:"pointerenter",leave:"pointerleave"}:nt()?{up:"mouseup",down:["mousedown","touchstart"],move:"touchmove",enter:"touchenter",leave:"touchend"}:{up:"mouseup",down:["mousedown"],move:"mousemove",enter:"mouseenter",leave:"mouseleave"};var ot;function rt(t){switch(t){case ot.Normal:return"p";case ot.Rectangle:return"r";case ot.Circle:return"c";case ot.Fill:return"b";case ot.Line:return"l";case ot.Erase:return"e";case ot.Marquee:return"s";default:return}}!function(t){t[t.Normal=0]="Normal",t[t.Rectangle=1]="Rectangle",t[t.Outline=2]="Outline",t[t.Circle=3]="Circle",t[t.Fill=4]="Fill",t[t.Line=5]="Line",t[t.Erase=6]="Erase",t[t.Marquee=7]="Marquee"}(ot||(ot={}));var ct=function t(e,i){Object(c.a)(this,t),this.width=e,this.height=i,this.offsetX=void 0,this.offsetY=void 0,this.offsetX=-(e>>1),this.offsetY=-(i>>1)},ht=function(){function t(e,i,n,a){Object(c.a)(this,t),this.canvasWidth=e,this.canvasHeight=i,this.color=n,this.toolWidth=a,this.startCol=void 0,this.startRow=void 0,this.isStarted=void 0,this.showPreview=void 0}return Object(h.a)(t,[{key:"doEdit",value:function(t){this.isStarted&&this.doEditCore(t)}},{key:"start",value:function(t,e,i){this.isStarted=!0,this.startCol=t,this.startRow=e,i.mergeFloatingLayer()}},{key:"end",value:function(t,e,i){}},{key:"getCursor",value:function(){return new ct(this.toolWidth,this.toolWidth)}},{key:"drawCursor",value:function(t,e,i){i(t,e)}}]),t}(),ut=function(t){function e(){var t,i;Object(c.a)(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(i=Object(u.a)(this,(t=Object(l.a)(e)).call.apply(t,[this].concat(a)))).endCol=void 0,i.endRow=void 0,i.isDragged=void 0,i}return Object(f.a)(e,t),Object(h.a)(e,[{key:"update",value:function(t,e){this.endCol=t,this.endRow=e,this.isDragged||t==this.startCol&&e==this.startRow||(this.isDragged=!0)}},{key:"topLeft",value:function(){return{x:Math.min(this.startCol,this.endCol),y:Math.min(this.startRow,this.endRow)}}},{key:"bottomRight",value:function(){return{x:Math.max(this.startCol,this.endCol),y:Math.max(this.startRow,this.endRow)}}}]),e}(ht),lt=function(t){function e(t,i,n,a){var s;return Object(c.a)(this,e),(s=Object(u.a)(this,Object(l.a)(e).call(this,t,i,n,a))).mask=void 0,s.showPreview=!0,s.mask=new at(t,i),s}return Object(f.a)(e,t),Object(h.a)(e,[{key:"update",value:function(t,e){this.interpolate(this.startCol,this.startRow,t,e),this.startCol=t,this.startRow=e}},{key:"interpolate",value:function(t,e,i,n){var a=this,s=i-t,o=n-e,r=function(t,e){return a.mask.set(t,e)};if(0!==s)for(var c=s>0?1:-1,h=o>0?1:-1,u=Math.abs(o/s),l=0,d=e,f=t;c>0?f<=i:f>=i;f+=c)for(this.drawCore(f,d,r),l+=u;l>=.5;)(h>0?d<=n:d>=n)&&this.drawCore(f,d,r),d+=h,l-=1;else for(var v=o>=0?n:e,p=o>=0?e:n;p<=v;p++)this.drawCore(t,p,r)}},{key:"doEditCore",value:function(t){for(var e=0;e<t.width;e++)for(var i=0;i<t.height;i++)this.mask.get(e,i)&&t.image.set(e,i,this.color)}},{key:"drawCursor",value:function(t,e,i){this.drawCore(t,e,i)}},{key:"drawCore",value:function(t,e,i){t-=Math.floor(this.toolWidth/2),e-=Math.floor(this.toolWidth/2);for(var n=0;n<this.toolWidth;n++)for(var a=0;a<this.toolWidth;a++){var s=t+n,o=e+a;s>=0&&s<this.canvasWidth&&o>=0&&o<this.canvasHeight&&i(t+n,e+a)}}}]),e}(ht),dt=function(t){function e(){var t,i;Object(c.a)(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(i=Object(u.a)(this,(t=Object(l.a)(e)).call.apply(t,[this].concat(a)))).showPreview=!0,i}return Object(f.a)(e,t),Object(h.a)(e,[{key:"doEditCore",value:function(t){var e=this.topLeft();e.x-=this.toolWidth>>1,e.y-=this.toolWidth>>1;var i=this.bottomRight();i.x+=this.toolWidth>>1,i.y+=this.toolWidth>>1;for(var n=0;n<this.toolWidth;n++)this.drawRectangle(t,{x:e.x+n,y:e.y+n},{x:i.x-n,y:i.y-n})}},{key:"drawRectangle",value:function(t,e,i){if(!(e.x>i.x||e.y>i.y)){for(var n=e.x;n<=i.x;n++)t.image.set(n,e.y,this.color),t.image.set(n,i.y,this.color);for(var a=e.y;a<=i.y;a++)t.image.set(e.x,a,this.color),t.image.set(i.x,a,this.color)}}},{key:"drawCursor",value:function(t,e,i){this.drawCore(t,e,i)}},{key:"drawCore",value:function(t,e,i){t-=Math.floor(this.toolWidth/2),e-=Math.floor(this.toolWidth/2);for(var n=0;n<this.toolWidth;n++)for(var a=0;a<this.toolWidth;a++){var s=t+n,o=e+a;s>=0&&s<this.canvasWidth&&o>=0&&o<this.canvasHeight&&i(t+n,e+a)}}}]),e}(ut),ft=function(t){function e(){var t,i;Object(c.a)(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(i=Object(u.a)(this,(t=Object(l.a)(e)).call.apply(t,[this].concat(a)))).showPreview=!0,i}return Object(f.a)(e,t),Object(h.a)(e,[{key:"doEditCore",value:function(t){this.bresenham(this.startCol,this.startRow,this.endCol,this.endRow,t)}},{key:"bresenham",value:function(t,e,i,n,a){var s=this,o=i-t,r=n-e,c=function(t,e){return a.image.set(t,e,s.color)};if(0!==o)for(var h=o>0?1:-1,u=r>0?1:-1,l=Math.abs(r/o),d=0,f=e,v=t;h>0?v<=i:v>=i;v+=h)for(this.drawCore(v,f,c),d+=l;d>=.5;)(u>0?f<=n:f>=n)&&this.drawCore(v,f,c),f+=u,d-=1;else for(var p=r>=0?n:e,y=r>=0?e:n;y<=p;y++)this.drawCore(t,y,c)}},{key:"drawCursor",value:function(t,e,i){this.drawCore(t,e,i)}},{key:"drawCore",value:function(t,e,i){t-=Math.floor(this.toolWidth/2),e-=Math.floor(this.toolWidth/2);for(var n=0;n<this.toolWidth;n++)for(var a=0;a<this.toolWidth;a++){i(t+n,e+a)}}}]),e}(ut),vt=function(t){function e(){var t,i;Object(c.a)(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(i=Object(u.a)(this,(t=Object(l.a)(e)).call.apply(t,[this].concat(a)))).showPreview=!0,i}return Object(f.a)(e,t),Object(h.a)(e,[{key:"doEditCore",value:function(t){var e=this.topLeft(),i=this.bottomRight(),n=i.x-e.x,a=i.y-e.y,s=Math.floor(Math.hypot(n,a)),o=this.startCol,r=this.startRow;this.midpoint(o,r,s,t)}},{key:"midpoint",value:function(t,e,i,n){for(var a=i-1,s=0,o=1,r=1,c=o-2*i;a>=s;)n.image.set(t+a,e+s,this.color),n.image.set(t+a,e-s,this.color),n.image.set(t+s,e+a,this.color),n.image.set(t+s,e-a,this.color),n.image.set(t-s,e+a,this.color),n.image.set(t-s,e-a,this.color),n.image.set(t-a,e+s,this.color),n.image.set(t-a,e-s,this.color),c<=0&&(s++,c+=r,r+=2),c>0&&(a--,c+=(o+=2)-2*i)}},{key:"getCursor",value:function(){return new ct(1,1)}}]),e}(ut),pt=function(t){function e(){var t,i;Object(c.a)(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(i=Object(u.a)(this,(t=Object(l.a)(e)).call.apply(t,[this].concat(a)))).col=void 0,i.row=void 0,i.showPreview=!0,i}return Object(f.a)(e,t),Object(h.a)(e,[{key:"start",value:function(t,e,i){this.isStarted=!0,this.col=t,this.row=e,i.mergeFloatingLayer()}},{key:"update",value:function(t,e){this.col=t,this.row=e}},{key:"doEditCore",value:function(t){var e=t.image.get(this.col,this.row);if(e!==this.color){var i=new at(t.width,t.height);i.set(this.col,this.row);for(var n=[{x:this.col,y:this.row}];n.length;){var a=n.pop();t.image.get(a.x,a.y)===e&&(t.image.set(a.x,a.y,this.color),s(a.x+1,a.y),s(a.x-1,a.y),s(a.x,a.y+1),s(a.x,a.y-1))}}function s(t,e){t>=0&&t<i.width&&e>=0&&e<i.height&&!i.get(t,e)&&(i.set(t,e),n.push({x:t,y:e}))}}},{key:"getCursor",value:function(){return new ct(1,1)}}]),e}(ht),yt=function(t){function e(){var t,i;Object(c.a)(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(i=Object(u.a)(this,(t=Object(l.a)(e)).call.apply(t,[this].concat(a)))).isMove=!1,i.showPreview=!1,i}return Object(f.a)(e,t),Object(h.a)(e,[{key:"start",value:function(t,e,i){this.isStarted=!0,this.startCol=t,this.startRow=e,i.floatingLayer&&(i.inFloatingLayer(t,e)?this.isMove=!0:i.mergeFloatingLayer())}},{key:"end",value:function(t,e,i){!this.isDragged&&i.floatingLayer&&i.mergeFloatingLayer()}},{key:"doEditCore",value:function(t){var e=this.topLeft(),i=this.bottomRight();this.isDragged&&(this.isMove?(t.layerOffsetX=t.floatingLayer.x0+this.endCol-this.startCol,t.layerOffsetY=t.floatingLayer.y0+this.endRow-this.startRow):t.copyToLayer(e.x,e.y,i.x-e.x+1,i.y-e.y+1,!0))}},{key:"getCursor",value:function(){}}]),e}(ut),gt=i(8),mt=2,bt=1,kt=2,wt=function(){function t(e,i,n){var a=this;Object(c.a)(this,t),this.cx=void 0,this.cy=void 0,this.root=void 0,this.clickHandler=void 0,this._title=void 0,this._shortcut=void 0,this.root=e,this.cx=i,this.cy=n,this.root.onClick(function(){return a.clickHandler&&a.clickHandler()}),this.root.appendClass("sprite-editor-button")}return Object(h.a)(t,[{key:"getElement",value:function(){return this.root}},{key:"addClass",value:function(t){this.root.appendClass(t)}},{key:"removeClass",value:function(t){this.root.removeClass(t)}},{key:"onClick",value:function(t){this.clickHandler=t}},{key:"translate",value:function(t,e){this.root.translate(t,e)}},{key:"title",value:function(t){this._title=t,this.setRootTitle()}},{key:"shortcut",value:function(t){this._shortcut=t,this.setRootTitle()}},{key:"setRootTitle",value:function(){this.root.title(this._title+(this._shortcut?" ("+this._shortcut+")":""))}},{key:"setDisabled",value:function(t){this.editClass("disabled",t)}},{key:"setSelected",value:function(t){this.editClass("selected",t)}},{key:"layout",value:function(){}},{key:"editClass",value:function(t,e){e?this.root.appendClass(t):this.root.removeClass(t)}}]),t}(),Et=function(t){function e(t,i,n){var a;return Object(c.a)(this,e),(a=Object(u.a)(this,Object(l.a)(e).call(this,t.root,t.cx,t.cy))).textEl=void 0,a.textEl=Rt(i).appendClass(n),a.textEl.moveTo(a.cx,a.cy),a.root.appendChild(a.textEl),a}return Object(f.a)(e,t),Object(h.a)(e,[{key:"setText",value:function(t){this.textEl.text(t),this.textEl.moveTo(this.cx,this.cy)}},{key:"getComputedTextLength",value:function(){try{return this.textEl.el.getComputedTextLength()}catch(t){return 8*this.textEl.el.textContent.length}}}]),e}(wt),Ct=function(t){function e(t,i,n,a){var s;return Object(c.a)(this,e),(s=Object(u.a)(this,Object(l.a)(e).call(this,t,i,n))).root.draw("rect").fill("white").size(a,a).at(Math.floor(s.cx-a/2),Math.floor(s.cy-a/2)),s}return Object(f.a)(e,t),e}(wt);function At(t,e){var i=Bt(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:e+kt-bt);return new Et(i,t,"sprite-editor-icon")}function Ot(t,e){var i=Bt(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:e+kt-bt);return new Et(i,t,"sprite-editor-xicon")}function jt(t,e,i,n,a){var s=(new P).appendClass("sprite-editor-button"),o=s.draw("path").appendClass("sprite-editor-button-bg");o.d.moveTo(a,0).lineBy(t-a,0).lineBy(0,e).lineBy(-(t-a),0).arcBy(a,a,0,!1,!0,-a,-a).lineBy(0,-(e-(a<<1))).arcBy(a,a,0,!1,!0,a,-a).close(),o.update();var r=s.draw("path").appendClass("sprite-editor-button-fg");return r.d.moveTo(n+a,n).lineBy(t-n-a,0).lineBy(0,e-i-n).lineBy(-(t-n-a),0).arcBy(a,a,0,!1,!0,-a,-a).lineBy(0,-(e-i-n-(a<<1))).arcBy(a,a,0,!1,!0,a,-a).close(),r.update(),{root:s,cx:n+(t-n)/2,cy:n+(e-i)/2}}var xt=function(){function t(e,i){var n=this;Object(c.a)(this,t),this.root=void 0,this.selected=void 0,this.buttons=void 0,this.indexHandler=void 0,this.root=e.group();var a=[4,7,10];this.buttons=Dt(65,21,3).map(function(t,e){return new Ct(t.root,t.cx,t.cy,a[e])}),this.buttons.forEach(function(t,e){t.onClick(function(){return n.handleClick(e)}),t.title(function(t){switch(t){case 0:return"Small Cursor";case 1:return"Medium Cursor";case 2:return"Large Cursor"}return}(e)),n.root.appendChild(t.getElement())})}return Object(h.a)(t,[{key:"handleClick",value:function(t){t!==this.selected&&(void 0!=this.selected&&this.buttons[this.selected].setSelected(!1),this.selected=t,void 0!=this.selected&&this.buttons[this.selected].setSelected(!0),this.indexHandler&&this.indexHandler(t))}},{key:"onSelected",value:function(t){this.indexHandler=t}}]),t}(),Lt=function(){function t(e,i,n,a){var s=this;Object(c.a)(this,t),this.root=void 0,this.undo=void 0,this.redo=void 0,this.host=void 0,this.root=e.group(),this.host=i;var o=Dt(n,a,2),r=Object(gt.a)(o,2),h=r[0],u=r[1];this.undo=new Et(h,"\uf118","sprite-editor-xicon"),this.undo.onClick(function(){return s.host.undo()}),this.root.appendChild(this.undo.getElement()),this.redo=new Et(u,"\uf111","sprite-editor-xicon"),this.redo.onClick(function(){return s.host.redo()}),this.root.appendChild(this.redo.getElement())}return Object(h.a)(t,[{key:"translate",value:function(t,e){this.root.translate(t,e)}},{key:"updateState",value:function(t,e){this.undo.setDisabled(t),this.redo.setDisabled(e)}}]),t}();function St(t,e,i,n){var a=(new P).appendClass("sprite-editor-button");a.draw("rect").appendClass("sprite-editor-button-bg").size(t,e),a.draw("rect").appendClass("sprite-editor-button-fg").size(t-n,e-i-n).at(n,n);return{root:a,cx:n+(t-n)/2,cy:n+(e-i)/2}}function Tt(t,e,i,n,a){var s=(new P).appendClass("sprite-editor-button"),o=s.draw("path").appendClass("sprite-editor-button-bg");o.d.moveTo(0,0).lineBy(t-a,0).arcBy(a,a,0,!1,!0,a,a).lineBy(0,e-(a<<1)).arcBy(a,a,0,!1,!0,-a,a).lineBy(-(t-a),0).lineBy(0,-e).close(),o.update();var r=s.draw("path").appendClass("sprite-editor-button-fg");return r.d.moveTo(n,n).lineBy(t-n-a,0).arcBy(a,a,0,!1,!0,a,a).lineBy(0,e-n-i-(a<<1)).arcBy(a,a,0,!1,!0,-a,a).lineBy(-(t-n-a),0).lineBy(0,-(e-n-i)).close(),r.update(),s.group().id("sprite-editor-button-content").translate(n+(t-(n<<1))>>1,e-i-n>>1),{root:s,cx:t/2,cy:n+(e-i)/2}}function Bt(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:kt,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:bt,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:mt,s=(new P).appendClass("sprite-editor-button");return s.draw("rect").size(t,e).corners(a,a).appendClass("sprite-editor-button-bg"),s.draw("rect").at(n,n).size(t-(n<<1),e-i-n).corners(a,a).appendClass("sprite-editor-button-fg"),{root:s,cx:t/2,cy:n+(e-i)/2}}function Dt(t,e,i){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:kt,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:bt,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:mt,o=t-(i+1)*a,r=Math.floor(o/i),c=[],h=0;h<i;h++)if(0===h)c.push(jt(r+a,e,n,a,s));else if(h===i-1){var u=Tt(r+(a<<1),e,n,a,s);u.root.translate((a+r)*h,0),c.push(u)}else{var l=St(r+a,e,n,a);l.root.translate((a+r)*h,0),c.push(l)}return c}function Rt(t){return new N(t).anchor("middle").setAttribute("dominant-baseline","middle").setAttribute("dy","0.1em")}var Mt,Pt,Ht=65,It=31,Wt=function(){function t(e,i,n){Object(c.a)(this,t),this.root=void 0,this.host=void 0,this.palette=void 0,this.colorSwatches=void 0,this.pencilTool=void 0,this.eraseTool=void 0,this.rectangleTool=void 0,this.fillTool=void 0,this.marqueeTool=void 0,this.sizeGroup=void 0,this.buttonGroup=void 0,this.paletteGroup=void 0,this.selectedTool=void 0,this.selectedSwatch=void 0,this.colorPreview=void 0,this.undoRedo=void 0,this.palette=e,this.host=i,this.root=n.group().id("sprite-editor-sidebar"),this.undoRedo=new Lt(this.root,i,Ht,It),this.initSizes(),this.initTools(),this.initPalette()}return Object(h.a)(t,[{key:"updateUndoRedo",value:function(t,e){this.undoRedo.updateState(t,e)}},{key:"setTool",value:function(t){this.host.setActiveTool(t),this.selectedTool&&this.selectedTool.removeClass("selected"),this.selectedTool=this.getButtonForTool(t),this.selectedTool&&this.selectedTool.addClass("selected")}},{key:"setColor",value:function(t){this.host.setActiveColor(t),this.selectedSwatch&&this.selectedSwatch.stroke("none"),this.selectedSwatch=this.colorSwatches[t],this.selectedSwatch&&(this.selectedSwatch.stroke("orange",4),this.colorPreview.fill(this.palette[t]))}},{key:"setCursorSize",value:function(t){this.host.setToolWidth(t)}},{key:"setWidth",value:function(t){this.root.scale(t/65)}},{key:"translate",value:function(t,e){this.root.translate(t,e)}},{key:"initSizes",value:function(){var t=this;this.sizeGroup=this.root.group().id("sprite-editor-cursor-buttons");var e=new xt(this.sizeGroup,65);e.onSelected(function(e){t.setCursorSize(1+2*e)}),e.selected=0,e.buttons[0].setSelected(!0)}},{key:"initTools",value:function(){this.buttonGroup=this.root.group().id("sprite-editor-tools").translate(0,65/3+3),this.pencilTool=this.initButton("Pencil","\uf0b2",ot.Normal),this.eraseTool=this.initButton("Erase","\uf12d",ot.Erase),this.eraseTool.translate(35,0),this.fillTool=this.initButton("Fill","\uf102",ot.Fill,!0),this.fillTool.translate(0,34),this.rectangleTool=this.initButton("Rectangle","\uf096",ot.Rectangle),this.rectangleTool.translate(35,34),this.marqueeTool=this.initButton("Marquee","\uf113",ot.Marquee,!0),this.marqueeTool.translate(0,68),this.setTool(ot.Normal),this.undoRedo.translate(0,430)}},{key:"initPalette",value:function(){var t=this;this.paletteGroup=this.root.group().id("sprite-editor-palette").translate(0,65/3+3+93+3+7);this.paletteGroup.draw("rect").fill("#000000").size(65,32),this.paletteGroup.draw("rect").fill("#000000").at(0,39).size(65,1+32*(this.palette.length>>1)),this.paletteGroup.def().create("clipPath","sprite-editor-selected-color").clipPathUnits(!0).draw("rect").at(0,0).size(1,1),this.colorPreview=this.paletteGroup.draw("rect").at(1,1).size(63,30),this.colorSwatches=[];for(var e=function(e){var i=e%2,n=Math.floor(e/2),a=t.paletteGroup.draw("rect").size(31,31).at(i?33:1,40+32*n).fill(t.palette[e]).clipPath("url(#sprite-editor-selected-color)").onClick(function(){return t.setColor(e)});a.title("".concat(e)),t.colorSwatches.push(a)},i=0;i<this.palette.length;i++)e(i);this.setColor(0)}},{key:"initButton",value:function(t,e,i){var n=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=a?Ot(e,31):At(e,31),o=rt(i);return o&&s.shortcut(o),s.title(t),s.onClick(function(){n.host.setIconsToDefault(),n.setTool(i)}),this.buttonGroup.appendChild(s.getElement()),s}},{key:"getButtonForTool",value:function(t){switch(t){case ot.Normal:case ot.Line:return this.pencilTool;case ot.Erase:return this.eraseTool;case ot.Fill:return this.fillTool;case ot.Rectangle:case ot.Circle:return this.rectangleTool;case ot.Marquee:return this.marqueeTool;default:return}}}]),t}(),qt="#dedede",Nt=function(){function t(e,i){var n=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3?arguments[3]:void 0;Object(c.a)(this,t),this.palette=e,this.state=i,this.lightMode=a,this.cellWidth=16,this.cellHeight=16,this.gesture=void 0,this.context=void 0,this.fadeAnimation=void 0,this.selectAnimation=void 0,this.backgroundLayer=void 0,this.paintLayer=void 0,this.overlayLayer=void 0,this.mouseCol=void 0,this.mouseRow=void 0,this.scale=void 0,this.upHandler=function(t){n.endDrag();var e=n.clientEventToCell(t),i=Object(gt.a)(e,2),a=i[0],s=i[1];n.gesture.handle(Mt.Up,a,s),t.stopPropagation(),t.preventDefault()},this.leaveHandler=function(t){n.endDrag();var e=n.clientEventToCell(t),i=Object(gt.a)(e,2),a=i[0],s=i[1];n.gesture.handle(Mt.Leave,a,s),t.stopPropagation(),t.preventDefault()},this.moveHandler=function(t){var e=n.clientEventToCell(t),i=Object(gt.a)(e,2),a=i[0],s=i[1];a>=0&&s>=0&&a<n.image.width&&s<n.image.height&&(1&t.buttons&&n.gesture.handle(Mt.Down,a,s),n.gesture.handle(Mt.Move,a,s)),t.stopPropagation(),t.preventDefault()},this.hoverHandler=function(t){var e=n.clientEventToCell(t),i=Object(gt.a)(e,2),a=i[0],s=i[1];a>=0&&s>=0&&a<n.image.width&&s<n.image.height?(n.gesture.handle(Mt.Move,a,s),n.gesture.isHover=!0):n.gesture.isHover&&(n.gesture.isHover=!1,n.gesture.handle(Mt.Leave,-1,-1))},this.scale=s,this.paintLayer=document.createElement("canvas"),this.paintLayer.setAttribute("class","sprite-editor-canvas"),this.overlayLayer=document.createElement("canvas"),this.overlayLayer.setAttribute("class","sprite-editor-canvas"),this.lightMode?(this.context=this.paintLayer.getContext("2d",{alpha:!1}),this.context.fillStyle=qt,this.context.fill()):(this.backgroundLayer=document.createElement("canvas"),this.backgroundLayer.setAttribute("class","sprite-editor-canvas"),this.context=this.paintLayer.getContext("2d")),this.hideOverlay()}return Object(h.a)(t,[{key:"setEyedropperMouse",value:function(t){}},{key:"repaint",value:function(){this.clearContext(this.context),this.drawImage(),this.state.floatingLayer?this.drawFloatingLayer():this.hideOverlay()}},{key:"applyEdit",value:function(t,e,i){arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.doEdit(this.state),this.drawCursor(t,e,i)}},{key:"drawCursor",value:function(t,e,i){var n=this,a=t.getCursor();a?(this.repaint(),t.showPreview&&t.drawCursor(e,i,function(e,i){n.drawColor(e,i,t.color)}),this.context.strokeStyle="#898989",this.context.strokeRect((e+a.offsetX)*this.cellWidth,(i+a.offsetY)*this.cellHeight,a.width*this.cellWidth,a.height*this.cellHeight)):t.isStarted&&this.repaint()}},{key:"bitmap",value:function(){return this.image}},{key:"outerWidth",value:function(){return this.paintLayer.getBoundingClientRect().width}},{key:"outerHeight",value:function(){return this.paintLayer.getBoundingClientRect().height}},{key:"writeColor",value:function(t,e,i){this.image.set(t,e,i),this.drawColor(t,e,i)}},{key:"drawColor",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.context,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:!this.lightMode,s=t*this.cellWidth,o=e*this.cellHeight;i?(n.fillStyle=this.palette[i-1],n.fillRect(s,o,this.cellWidth,this.cellHeight)):a||(n.fillStyle=qt,n.fillRect(s,o,this.cellWidth,this.cellHeight))}},{key:"restore",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.height!=this.image.height||t.width!=this.image.width?(this.state=t.copy(),this.resizeGrid(t.width,t.width*t.height)):this.state=t.copy(),e&&this.repaint()}},{key:"showResizeOverlay",value:function(){var t=this;if(!this.lightMode){this.fadeAnimation&&this.fadeAnimation.kill(),this.showOverlay(),this.stopSelectAnimation();var e=this.overlayLayer.width,i=this.overlayLayer.height,n=this.overlayLayer.getContext("2d"),a=e/2-50,s=i/2-25;this.fadeAnimation=new Ft(function(o,r){if(r)t.drawFloatingLayer();else{if(t.clearContext(n),n.globalAlpha=o,n.fillStyle="#898989",t.image.width<=32&&t.image.height<=32){for(var c=1;c<t.image.width;c++)n.fillRect(c*t.cellWidth,0,1,i);for(var h=1;h<t.image.height;h++)n.fillRect(0,h*t.cellHeight,e,1)}n.fillRect(a,s,100,40),n.fillStyle="#ffffff",n.font="30px sans-serif",n.textBaseline="middle",n.textAlign="center",n.fillText(t.image.width.toString(),a+50-25,s+20),n.fillText("x",a+50,s+20,10),n.fillText(t.image.height.toString(),a+50+25,s+20)}},750,500)}}},{key:"showOverlay",value:function(){this.overlayLayer.style.visibility="visible"}},{key:"hideOverlay",value:function(){this.stopSelectAnimation(),this.overlayLayer.style.visibility="hidden",this.fadeAnimation&&this.fadeAnimation.kill()}},{key:"resizeGrid",value:function(t,e){this.repaint()}},{key:"setCellDimensions",value:function(t,e){this.cellWidth=0|t,this.cellHeight=0|e;var i=this.cellWidth*this.image.width,n=this.cellHeight*this.image.height;this.paintLayer.width=i,this.paintLayer.height=n,this.overlayLayer.width=i,this.overlayLayer.height=n,this.lightMode||(this.backgroundLayer.width=i,this.backgroundLayer.height=n)}},{key:"setGridDimensions",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=t/this.image.width,a=e/this.image.height;if(i){var s=this.cellWidth/this.cellHeight;if(s>=1){var o=Math.min(n,a*s);this.setCellDimensions(o,o*s)}else{var r=Math.min(a,n/s);this.setCellDimensions(r/s,r)}}else this.setCellDimensions(n,a)}},{key:"down",value:function(t){this.initDragSurface(),this.gesture.subscribe(Pt.Down,t)}},{key:"up",value:function(t){this.initDragSurface(),this.gesture.subscribe(Pt.Up,t)}},{key:"drag",value:function(t){this.initDragSurface(),this.gesture.subscribe(Pt.Drag,t)}},{key:"move",value:function(t){this.initDragSurface(),this.gesture.subscribe(Pt.Move,t)}},{key:"leave",value:function(t){this.initDragSurface(),this.gesture.subscribe(Pt.Leave,t)}},{key:"updateBounds",value:function(t,e,i,n){this.layoutCanvas(this.paintLayer,t,e,i,n),this.layoutCanvas(this.overlayLayer,t,e,i,n),this.lightMode||this.layoutCanvas(this.backgroundLayer,t,e,i,n),this.drawImage(),this.drawBackground()}},{key:"render",value:function(t){this.lightMode||t.appendChild(this.backgroundLayer),t.appendChild(this.paintLayer),t.appendChild(this.overlayLayer)}},{key:"removeMouseListeners",value:function(){this.stopSelectAnimation(),this.fadeAnimation&&this.fadeAnimation.kill(),this.endDrag()}},{key:"onEditStart",value:function(t,e,i){i.start(t,e,this.state)}},{key:"onEditEnd",value:function(t,e,i){i.end(t,e,this.state),this.drawFloatingLayer()}},{key:"drawImage",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.image,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.context,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:!this.lightMode,s=0;s<t.width;s++)for(var o=0;o<t.height;o++)this.drawColor(i+s,n+o,t.get(s,o),e,a)}},{key:"drawBackground",value:function(){if(!this.lightMode){var t=this.backgroundLayer.getContext("2d",{alpha:!1}),e=Math.ceil(this.paintLayer.width/5),i=Math.ceil(this.paintLayer.height/5);t.fillStyle="#ffffff",t.fillRect(0,0,this.paintLayer.width,this.paintLayer.height),t.fillStyle="#dedede";for(var n=0;n<e;n++)for(var a=0;a<i;a++)(n+a)%2&&t.fillRect(5*n,5*a,5,5)}}},{key:"clientEventToCell",value:function(t){var e=function(t){if(t.touches){var e=t;return e.touches.length?e.touches[0]:e.changedTouches[0]}return t}(t),i=this.paintLayer.getBoundingClientRect(),n=i.left+(null!==window.scrollX?window.scrollX:window.pageXOffset),a=i.top+(null!==window.scrollY?window.scrollY:window.pageYOffset);return this.mouseCol=Math.floor((e.clientX-n)/this.cellWidth),this.mouseRow=Math.floor((e.clientY-a)/this.cellHeight),[this.mouseCol,this.mouseRow]}},{key:"drawFloatingLayer",value:function(){this.state.floatingLayer&&(this.drawImage(this.state.floatingLayer,this.context,this.state.layerOffsetX,this.state.layerOffsetY,!0),this.drawSelectionAnimation())}},{key:"drawSelectionAnimation",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.state.floatingLayer){this.showOverlay();var i=this.overlayLayer.getContext("2d");if(this.clearContext(i),i.globalAlpha=1,i.strokeStyle="#303030",i.lineWidth=2,i.setLineDash([5,3]),i.lineDashOffset=e,i.strokeRect(this.state.layerOffsetX*this.cellWidth,this.state.layerOffsetY*this.cellHeight,this.state.floatingLayer.width*this.cellWidth,this.state.floatingLayer.height*this.cellHeight),!this.lightMode&&!this.selectAnimation&&(!this.fadeAnimation||this.fadeAnimation.dead)){var n=function(){e++,requestAnimationFrame(function(){return t.drawSelectionAnimation(e)})};this.selectAnimation=window.setInterval(n,40)}}else this.hideOverlay()}},{key:"clearContext",value:function(t){t.clearRect(0,0,this.paintLayer.width,this.paintLayer.height)}},{key:"initDragSurface",value:function(){this.gesture||(this.gesture=new Ut,this.bindEvents(this.paintLayer),this.bindEvents(this.overlayLayer),document.addEventListener(st.move,this.hoverHandler))}},{key:"bindEvents",value:function(t){var e=this;st.down.forEach(function(i){t.addEventListener(i,function(t){e.startDrag();var i=e.clientEventToCell(t),n=Object(gt.a)(i,2),a=n[0],s=n[1];e.gesture.handle(Mt.Down,a,s)})})}},{key:"startDrag",value:function(){document.removeEventListener(st.move,this.hoverHandler),document.addEventListener(st.move,this.moveHandler),document.addEventListener(st.up,this.upHandler),nt()&&!it()?(document.addEventListener("touchend",this.upHandler),document.addEventListener("touchcancel",this.leaveHandler)):document.addEventListener(st.leave,this.leaveHandler)}},{key:"endDrag",value:function(){document.addEventListener(st.move,this.hoverHandler),document.removeEventListener(st.move,this.moveHandler),document.removeEventListener(st.up,this.upHandler),document.removeEventListener(st.leave,this.leaveHandler),nt()&&!it()?(document.removeEventListener("touchend",this.upHandler),document.removeEventListener("touchcancel",this.leaveHandler)):document.removeEventListener(st.leave,this.leaveHandler)}},{key:"layoutCanvas",value:function(t,e,i,n,a){t.style.position="absolute",t.style.top="0px",t.style.left="0px"}},{key:"stopSelectAnimation",value:function(){this.selectAnimation&&(clearInterval(this.selectAnimation),this.selectAnimation=void 0)}},{key:"image",get:function(){return this.state.image}}]),t}();!function(t){t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Move=2]="Move",t[t.Leave=3]="Leave"}(Mt||(Mt={})),function(t){t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Move=2]="Move",t[t.Drag=3]="Drag",t[t.Leave=4]="Leave"}(Pt||(Pt={}));var Ut=function(){function t(){Object(c.a)(this,t),this.lastCol=void 0,this.lastRow=void 0,this.isDown=!1,this.isHover=!1,this.handlers={}}return Object(h.a)(t,[{key:"handle",value:function(t,e,i){switch(t){case Mt.Up:this.update(e,i),this.isDown=!1,this.fire(Pt.Up);break;case Mt.Down:this.isDown||(this.update(e,i),this.isDown=!0,this.fire(Pt.Down));break;case Mt.Move:if(e===this.lastCol&&i===this.lastRow)return;this.update(e,i),this.isDown?this.fire(Pt.Drag):this.fire(Pt.Move);break;case Mt.Leave:this.update(e,i),this.isDown=!1,this.fire(Pt.Leave)}}},{key:"subscribe",value:function(t,e){this.handlers[t]=e}},{key:"update",value:function(t,e){this.lastCol=t,this.lastRow=e}},{key:"fire",value:function(t){this.handlers[t]&&this.handlers[t](this.lastCol,this.lastRow)}}]),t}(),Ft=function(){function t(e,i,n){var a=this;Object(c.a)(this,t),this.draw=e,this.start=void 0,this.end=void 0,this.slope=void 0,this.dead=void 0,this.start=Date.now()+i,this.end=this.start+n,this.slope=1/n,this.dead=!1,e(1,!1),setTimeout(function(){return requestAnimationFrame(function(){return a.frame()})},i)}return Object(h.a)(t,[{key:"frame",value:function(){var t=this;if(!this.dead){var e=Date.now();if(e<this.end){var i=1-this.slope*(e-this.start);this.draw(i,!1),requestAnimationFrame(function(){return t.frame()})}else this.kill(),this.draw(0,!0)}}},{key:"kill",value:function(){this.dead=!0}}]),t}();var Yt=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(c.a)(this,t),this.width=e,this.height=i,this.x0=n,this.y0=a,this.buf=void 0,this.buf=new Uint8Array(Math.ceil(e*i/2))}return Object(h.a)(t,[{key:"set",value:function(t,e,i){if(t<this.width&&e<this.height&&t>=0&&e>=0){var n=this.coordToIndex(t,e);this.setCore(n,i)}}},{key:"get",value:function(t,e){if(t<this.width&&e<this.height&&t>=0&&e>=0){var i=this.coordToIndex(t,e);return this.getCore(i)}return 0}},{key:"copy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.width,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.height,s=new t(n,a);s.x0=e,s.y0=i;for(var o=0;o<n;o++)for(var r=0;r<a;r++)s.set(o,r,this.get(e+o,i+r));return s}},{key:"apply",value:function(t){for(var e,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=0;n<t.width;n++)for(var a=0;a<t.height;a++)!(e=t.get(n,a))&&i||this.set(t.x0+n,t.y0+a,e)}},{key:"equals",value:function(t){if(this.width===t.width&&this.height===t.height&&this.x0===t.x0&&this.y0===t.y0&&this.buf.length===t.buf.length){for(var e=0;e<this.buf.length;e++)if(this.buf[e]!==t.buf[e])return!1;return!0}return!1}},{key:"coordToIndex",value:function(t,e){return t+e*this.width}},{key:"getCore",value:function(t){var e=Math.floor(t/2);return t%2===0?15&this.buf[e]:(240&this.buf[e])>>4}},{key:"setCore",value:function(t,e){var i=Math.floor(t/2);this.buf[i]=t%2===0?240&this.buf[i]|15&e:15&this.buf[i]|(15&e)<<4}}]),t}();function Xt(t,e){!(t=(t=(t=t.replace(/[ `]|(?:&#96;)|(?:&#9;)|(?:img)/g,"").trim()).replace(/^["`\(\)]*/,"").replace(/["`\(\)]*$/,"")).replace(/&#10;/g,"\n"))&&e&&(t=e);for(var i=t.split("\n"),n=[],a=0,s=0;s<i.length;s++){for(var o=i[s],r=[],c=0;c<o.length;c++)switch(o[c]){case"0":case".":r.push(0);break;case"1":case"#":r.push(1);break;case"2":case"T":r.push(2);break;case"3":case"t":r.push(3);break;case"4":case"N":r.push(4);break;case"5":case"n":r.push(5);break;case"6":case"G":r.push(6);break;case"7":case"g":r.push(7);break;case"8":r.push(8);break;case"9":r.push(9);break;case"a":case"A":case"R":r.push(10);break;case"b":case"B":case"P":r.push(11);break;case"c":case"C":case"p":r.push(12);break;case"d":case"D":case"O":r.push(13);break;case"e":case"E":case"Y":r.push(14);break;case"f":case"F":case"W":r.push(15)}r.length&&(n.push(r),a=Math.max(a,r.length))}for(var h=n.length,u=new Yt(a,h),l=0;l<h;l++)for(var d=n[l],f=0;f<a;f++)f<d.length?u.set(f,l,d[f]):u.set(f,l,0);return u}var zt=function(){function t(e){Object(c.a)(this,t),this.image=void 0,this.floatingLayer=void 0,this.layerOffsetX=void 0,this.layerOffsetY=void 0,this.image=e,this.layerOffsetX=0,this.layerOffsetY=0}return Object(h.a)(t,[{key:"copy",value:function(){var e=new t;return e.image=this.image.copy(),this.floatingLayer&&(e.floatingLayer=this.floatingLayer.copy(),e.floatingLayer.x0=this.layerOffsetX,e.floatingLayer.y0=this.layerOffsetY),e.layerOffsetX=this.layerOffsetX,e.layerOffsetY=this.layerOffsetY,e}},{key:"equals",value:function(t){return!(!this.image.equals(t.image)||this.floatingLayer&&!t.floatingLayer||!this.floatingLayer&&t.floatingLayer)&&(!this.floatingLayer||this.floatingLayer.equals(t.floatingLayer)&&this.layerOffsetX===t.layerOffsetX&&this.layerOffsetY===t.layerOffsetY)}},{key:"mergeFloatingLayer",value:function(){this.floatingLayer&&(this.floatingLayer.x0=this.layerOffsetX,this.floatingLayer.y0=this.layerOffsetY,this.image.apply(this.floatingLayer,!0),this.floatingLayer=void 0)}},{key:"copyToLayer",value:function(t,e,i,n){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(0!==i&&0!==n&&(i<0&&(t+=i,i=-i),n<0&&(e+=n,n=-n),this.floatingLayer=this.image.copy(t,e,i,n),this.layerOffsetX=this.floatingLayer.x0,this.layerOffsetY=this.floatingLayer.y0,a))for(var s=0;s<i;s++)for(var o=0;o<n;o++)this.image.set(t+s,e+o,0)}},{key:"inFloatingLayer",value:function(t,e){return!!this.floatingLayer&&(t-=this.layerOffsetX,e-=this.layerOffsetY,t>=0&&t<this.floatingLayer.width&&e>=0&&e<this.floatingLayer.height)}},{key:"width",get:function(){return this.image.width}},{key:"height",get:function(){return this.image.height}}]),t}(),Gt=function(){function t(e,i){var n=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(c.a)(this,t),this.lightMode=a,this.scale=s,this.group=void 0,this.toolbarRoot=void 0,this.paintSurface=void 0,this.sidebar=void 0,this.header=void 0,this.state=void 0,this.cachedState=void 0,this.edit=void 0,this.activeTool=ot.Normal,this.toolWidth=1,this.color=1,this.cursorCol=0,this.cursorRow=0,this.undoStack=[],this.redoStack=[],this.undoRedo=void 0,this.columns=16,this.rows=16,this.colors=void 0,this.shiftDown=!1,this.altDown=!1,this.mouseDown=!1,this.closeHandler=void 0,this.keyDown=function(t){if(16==t.keyCode&&(n.shiftDown=!0,n.shiftAction()),18===t.keyCode&&(n.discardEdit(),n.paintSurface.setEyedropperMouse(!0),n.altDown=!0),n.state.floatingLayer){var e=!0;switch(t.keyCode){case 8:case 46:t.preventDefault(),t.stopPropagation(),n.state.floatingLayer=void 0;break;case 37:n.state.layerOffsetX--;break;case 38:n.state.layerOffsetY--;break;case 39:n.state.layerOffsetX++;break;case 40:n.state.layerOffsetY++;break;default:e=!1}e&&(n.updateEdit(),n.pushState(!0),n.paintSurface.restore(n.state,!0))}[ot.Fill,ot.Normal,ot.Rectangle,ot.Erase,ot.Circle,ot.Line,ot.Marquee].forEach(function(e){t.key===rt(e)&&(n.setIconsToDefault(),n.switchIconTo(e),n.sidebar.setTool(e))});if(t.keyCode>=48&&t.keyCode<=57){var i=t.keyCode-48;n.shiftDown&&(i+=9),i<=n.colors.length&&n.sidebar.setColor(i)}},this.keyUp=function(t){16===t.keyCode?(n.shiftDown=!1,n.clearShiftAction()):18===t.keyCode&&(n.altDown=!1,n.paintSurface.setEyedropperMouse(!1),n.updateEdit())},this.undoRedoEvent=function(t){var e=t.ctrlKey||t.metaKey;"Undo"===t.key||e&&"z"===t.key?(n.undo(),t.preventDefault(),t.stopPropagation()):("Redo"===t.key||e&&"y"===t.key)&&(n.redo(),t.preventDefault(),t.stopPropagation())},this.colors=["#ffffff","#ff2121","#ff93c4","#ff8135","#fff609","#249ca3","#78dc52","#003fad","#87f2ff","#8e2ec4","#a4839f","#5c406c","#e5cdc4","#91463d","#000000"],this.columns=e.width,this.rows=e.height,this.state=new zt(e.copy()),this.toolbarRoot=new M,this.toolbarRoot.setClass("sprite-canvas-controls"),this.group=this.toolbarRoot.group(),this.createDefs(),this.paintSurface=new Nt(this.colors,this.state.copy(),this.lightMode,this.scale),this.paintSurface.drag(function(t,e){n.debug("gesture ("+ot[n.activeTool]+")"),n.altDown||n.setCell(t,e,n.color,!1)}),this.paintSurface.up(function(t,e){if(n.debug("gesture end ("+ot[n.activeTool]+")"),n.altDown){var i=n.state.image.get(t,e);n.sidebar.setColor(i)}else n.paintSurface.onEditEnd(t,e,n.edit),n.state.floatingLayer&&!n.paintSurface.state.floatingLayer&&(n.pushState(!0),n.state=n.paintSurface.state.copy(),n.rePaint()),n.commit(),n.shiftAction();n.mouseDown=!1}),this.paintSurface.down(function(t,e){n.altDown||n.setCell(t,e,n.color,!1),n.mouseDown=!0}),this.paintSurface.move(function(t,e){n.drawCursor(t,e),n.shiftAction()}),this.paintSurface.leave(function(){n.edit&&(n.rePaint(),n.edit.isStarted&&!n.shiftDown&&n.commit())}),this.sidebar=new Wt(['url("#alpha-background")'].concat(this.colors),this,this.group),this.sidebar.setColor(this.colors.length>=3?3:1),this.updateUndoRedo(),this.scale=s}return Object(h.a)(t,[{key:"setSidebarColor",value:function(t){this.sidebar.setColor(t)}},{key:"setCell",value:function(t,e,i,n){n?(this.state.image.set(t,e,i),this.paintCell(t,e,i)):this.edit&&(this.edit.isStarted||(this.paintSurface.onEditStart(t,e,this.edit),this.state.floatingLayer&&!this.paintSurface.state.floatingLayer&&(this.pushState(!0),this.state=this.paintSurface.state.copy())),this.edit.update(t,e),this.cursorCol=t,this.cursorRow=e,this.paintEdit(this.edit,t,e))}},{key:"render",value:function(t){t.appendChild(this.toolbarRoot.el),this.layout(),this.toolbarRoot.attr({width:"".concat(65*this.scale,"px"),height:this.outerHeight()+"px"});var e=document.createElement("div");e.setAttribute("class","sprite-canvas-container"),t.appendChild(e),this.paintSurface.render(e)}},{key:"layout",value:function(){if(this.toolbarRoot){this.paintSurface.setGridDimensions(452*this.scale);var t=10*this.scale,e=85*this.scale;this.paintSurface.updateBounds(t,e,452*this.scale,452*this.scale)}}},{key:"rePaint",value:function(){this.commit(),this.paintSurface.repaint()}},{key:"setActiveColor",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e||this.color!=t&&(this.color=t,this.activeTool===ot.Erase?this.sidebar.setTool(ot.Normal):this.updateEdit())}},{key:"setActiveTool",value:function(t){this.activeTool!=t&&(this.activeTool=t,this.updateEdit())}},{key:"setToolWidth",value:function(t){this.toolWidth!=t&&(this.toolWidth=t,this.updateEdit())}},{key:"initializeUndoRedo",value:function(t,e){t&&(this.undoStack=t),e&&(this.redoStack=e),this.updateUndoRedo()}},{key:"getUndoStack",value:function(){return this.undoStack.slice()}},{key:"getRedoStack",value:function(){return this.redoStack.slice()}},{key:"undo",value:function(){if(this.undoStack.length){this.debug("undo");var t=this.undoStack.pop();if(this.pushState(!1),t.equals(this.state))return void this.undo();this.restore(t)}this.updateUndoRedo()}},{key:"redo",value:function(){if(this.redoStack.length){this.debug("redo");var t=this.redoStack.pop();this.pushState(!0),this.restore(t)}this.updateUndoRedo()}},{key:"resize",value:function(t,e){this.cachedState||(this.cachedState=this.state.copy(),this.undoStack.push(this.cachedState),this.redoStack=[]),this.state.image=function(t,e,i){var n=new Yt(e,i);return n.apply(t),n}(this.cachedState.image,t,e),this.afterResize(!0)}},{key:"setSizePresets",value:function(t){}},{key:"canvasWidth",value:function(){return this.columns}},{key:"canvasHeight",value:function(){return this.rows}},{key:"outerWidth",value:function(){return 539*this.scale}},{key:"outerHeight",value:function(){return 465*this.scale}},{key:"bitmap",value:function(){return this.state}},{key:"showGallery",value:function(){}},{key:"hideGallery",value:function(){}},{key:"closeEditor",value:function(){if(this.closeHandler){var t=this.closeHandler;this.closeHandler=void 0,t()}this.state.floatingLayer&&(this.state.mergeFloatingLayer(),this.pushState(!0))}},{key:"onClose",value:function(t){this.closeHandler=t}},{key:"switchIconTo",value:function(t){var e=this;if(this.activeTool!==t){var i=this.sidebar.getButtonForTool(t);switch(t){case ot.Rectangle:n(i,"\uf096","Rectangle");break;case ot.Circle:n(i,"\uf10c","Circle");break;case ot.Normal:n(i,"\uf040","Pencil");break;case ot.Line:n(i,"\uf07e","Line");break;default:return}i.onClick(function(){t!=ot.Circle&&t!=ot.Line&&(e.setIconsToDefault(),e.sidebar.setTool(t))})}function n(e,i,n){var a=rt(t);e.setText(i),e.title(n),e.shortcut(a)}}},{key:"setIconsToDefault",value:function(){this.switchIconTo(ot.Rectangle),this.switchIconTo(ot.Normal)}},{key:"addKeyListeners",value:function(){document.addEventListener("keydown",this.keyDown),document.addEventListener("keyup",this.keyUp),document.addEventListener("keydown",this.undoRedoEvent,!0)}},{key:"removeKeyListeners",value:function(){document.removeEventListener("keydown",this.keyDown),document.removeEventListener("keyup",this.keyUp),document.removeEventListener("keydown",this.undoRedoEvent,!0),this.paintSurface.removeMouseListeners()}},{key:"afterResize",value:function(t){this.columns=this.state.width,this.rows=this.state.height,this.paintSurface.restore(this.state,!0),this.layout(),t&&this.paintSurface.showResizeOverlay(),this.updateEdit()}},{key:"drawCursor",value:function(t,e){this.edit&&this.paintSurface.drawCursor(this.edit,t,e)}},{key:"paintEdit",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.paintSurface.restore(this.state),this.paintSurface.applyEdit(t,e,i,n)}},{key:"commit",value:function(){this.edit&&(this.cachedState&&(this.cachedState=void 0),this.pushState(!0),this.paintEdit(this.edit,this.cursorCol,this.cursorRow,!0),this.state=this.paintSurface.state.copy(),this.updateEdit(),this.redoStack=[])}},{key:"pushState",value:function(t){var e=t?this.undoStack:this.redoStack;e.length&&this.state.equals(e[e.length-1])||(e.push(this.state.copy()),this.updateUndoRedo())}},{key:"discardEdit",value:function(){this.edit&&(this.edit=void 0,this.rePaint())}},{key:"updateEdit",value:function(){this.altDown||(this.edit=this.newEdit())}},{key:"restore",value:function(t){t.width!==this.state.width||t.height!==this.state.height?(this.state=t,this.afterResize(!1)):(this.state=t.copy(),this.paintSurface.restore(t,!0))}},{key:"updateUndoRedo",value:function(){this.sidebar.updateUndoRedo(0===this.undoStack.length,0===this.redoStack.length)}},{key:"paintCell",value:function(t,e,i){this.paintSurface.writeColor(t,e,i)}},{key:"newEdit",value:function(){switch(this.activeTool){case ot.Normal:return new lt(this.columns,this.rows,this.color,this.toolWidth);case ot.Rectangle:case ot.Outline:return new dt(this.columns,this.rows,this.color,this.toolWidth);case ot.Line:return new ft(this.columns,this.rows,this.color,this.toolWidth);case ot.Circle:return new vt(this.columns,this.rows,this.color,this.toolWidth);case ot.Erase:return new lt(this.columns,this.rows,0,this.toolWidth);case ot.Fill:return new pt(this.columns,this.rows,this.color,this.toolWidth);case ot.Marquee:return new yt(this.columns,this.rows,this.color,this.toolWidth)}}},{key:"shiftAction",value:function(){if(this.shiftDown&&!this.altDown)switch(this.activeTool){case ot.Line:case ot.Rectangle:case ot.Circle:this.setCell(this.paintSurface.mouseCol,this.paintSurface.mouseRow,this.color,!1)}}},{key:"clearShiftAction",value:function(){if(!this.mouseDown)switch(this.activeTool){case ot.Line:case ot.Rectangle:case ot.Circle:this.updateEdit(),this.paintSurface.restore(this.state,!0)}}},{key:"debug",value:function(t){}},{key:"createDefs",value:function(){this.toolbarRoot.define(function(t){var e=t.create("pattern","alpha-background").size(10,10).units(C.userSpaceOnUse);e.draw("rect").at(0,0).size(10,10).fill("white"),e.draw("rect").at(0,0).size(5,5).fill("#dedede"),e.draw("rect").at(5,5).size(5,5).fill("#dedede")})}}]),t}();i(25);function Jt(t,e,i,n){for(var a=l(224|i)+l(t)+l(e)+"00",s=4,o=0,r=0,c=function(t){o|=t<<r,r==8-i?(a+=l(o),s++,o=0,r=0):r+=i},h=0;h<t;++h){for(var u=0;u<e;++u)c(n(h,u));for(;0!=r;)c(0);if(i>1)for(;3&s;)c(0)}return a;function l(t){return("0"+t.toString(16)).slice(-2)}}function Kt(t){if(t){if(6===t.length)return parseInt("0x"+t);if(7===t.length)return parseInt("0x"+t.substr(1))}return 0}function Vt(t){return t>>16&255}function Qt(t){return t>>8&255}function _t(t){return 255&t}var Zt=["#000000","#ffffff","#ff2121","#ff93c4","#ff8135","#fff609","#249ca3","#78dc52","#003fad","#87f2ff","#8e2ec4","#a4839f","#5c406c","#e5cdc4","#91463d","#000000"];!function(t){for(var e=[],i=0;i<t.length;i++){var n=Kt(t[i]);e.push([Vt(n),Qt(n),_t(n)])}}(Zt);function $t(t){return Jt(t.width,t.height,4,t.get.bind(t))}function te(t){var e=Xt(t);return e&&e.width&&e.height?e:null}function ee(t){return function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=Zt.slice(1),a=document.createElement("canvas"),s=(a.width=t.width*i,a.height=t.height*i,i);e=a.getContext("2d");for(var o=0;o<t.width;o++)for(var r=0;r<t.height;r++){var c=t.get(o,r);c&&(e.fillStyle=n[c-1],e.fillRect(0+o*s,0+r*s,s,s))}return a}(t).toDataURL()}function ie(t,e,i,n,a){var s=document.createElementNS("http://www.w3.org/2000/svg","image");return s.setAttribute("x","".concat(t)),s.setAttribute("y","".concat(e)),s.setAttribute("width","".concat(i,"px")),s.setAttribute("height","".concat(n,"px")),a&&ne(s,a),s}function ne(t,e){var i=ee(e);t.setAttributeNS("http://www.w3.org/1999/xlink","href","".concat(i))}var ae=10,se=541,oe=2*ae+64+10+20,re=2*ae+64,ce=function(t){function e(t){var i;return Object(c.a)(this,e),(i=Object(u.a)(this,Object(l.a)(e).call(this,t))).TabBarSvg=void 0,i.TOTAL_IMG_SPACE=void 0,i.LEFT_SPACE=void 0,i.TABS_START=void 0,i.state={currentTab:0},i.TOTAL_IMG_SPACE=re*i.props.tabImages.length,i.LEFT_SPACE=(se-i.TOTAL_IMG_SPACE)/2,i.TABS_START=i.LEFT_SPACE-ae,i}return Object(f.a)(e,t),Object(h.a)(e,[{key:"componentDidMount",value:function(){this.TabBarSvg=this.refs["tab-bar-svg"]}},{key:"componentWillUnmount",value:function(){this.TabBarSvg=void 0}},{key:"getTabPath",value:function(t){var e=64+2*ae,i=this.TABS_START+e*t,n=se-(i+e);return"M -".concat(35,",").concat(oe-20+35," l 0,-").concat(35," l ").concat(35,",0 h ").concat(i," q ").concat(ae,",0 ").concat(ae,",-").concat(ae," v -").concat(64," q 0,-").concat(ae," ").concat(ae,",-").concat(ae," h ").concat(64," q ").concat(ae,",0 ").concat(ae,",").concat(ae," v ").concat(64," q 0,").concat(ae," ").concat(ae,",").concat(ae," h ").concat(n," l ").concat(35,",0 l 0,").concat(35," z")}},{key:"render",value:function(){var t=this,e="0 0 ".concat(se," ").concat(oe),i=this.getTabPath(this.state.currentTab),n=this.props.tabImages.map(function(e,i){return{x:t.TABS_START+ae+ae+i*re,y:10+ae,w:64,h:64,idx:i,data:ee(e)}});function a(t){this.setState({currentTab:t}),this.props.tabChange(t)}return s.a.createElement("div",{ref:"tab-bar",className:"tab-bar"},s.a.createElement("svg",{ref:"tab-bar-svg",viewBox:e},s.a.createElement("path",{ref:"tab-path",d:i}),n.map(function(e){return s.a.createElement("image",{key:e.idx,x:e.x,y:e.y,width:e.w,height:e.h,href:e.data,onClick:a.bind(t,e.idx)})})))}}]),e}(s.a.Component);i(26),i(11),i(27);function he(t,e,i){ue()||window.appInsights.trackEvent(t,e,i)}function ue(){try{return"undefined"!==typeof window&&/^http:\/\/(localhost|127\.0\.0\.1):\d+\//.test(window.location.href)&&!/nolocalhost=1/.test(window.location.href)}catch(t){return!1}}function le(t){return de.apply(this,arguments)}function de(){return(de=Object(S.a)(L.a.mark(function t(e){return L.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t,i){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="text",n.onload=function(){var a=n.status;if(200===a)t(n.response);else{var s=new Error("Error response (".concat(a,") from '").concat(e,"'; content: ").concat(n.response));i(s)}},n.send()}));case 1:case"end":return t.stop()}},t)}))).apply(this,arguments)}var fe,ve,pe={character:"\n        . . . . . . . . . . . .\n        . . . 1 1 . 1 1 . . . .\n        . . . 1 3 . 1 3 . . . .\n        . . . . 1 3 . 1 3 . . .\n        . . . . 1 3 . 1 3 . . .\n        . . . 1 1 1 1 1 1 . . .\n        . . 1 1 1 1 1 1 1 1 . .\n        . . 1 1 1 f 1 1 f 1 . .\n        . . 1 1 1 1 1 1 1 1 . .\n        . . 1 1 1 1 f f 1 1 . .\n        . . . 1 1 1 1 1 1 . . .\n        . 1 1 1 1 1 1 1 1 1 1 .\n        . 1 1 1 1 1 1 1 1 1 1 .\n        . . . . 1 1 1 1 . . . .\n        . . . . 1 1 1 1 . . . .\n        . . . . 1 1 1 1 . . . .\n        . . . . 1 1 1 1 . . . .\n        . . . . . 1 1 . . . . .\n        . . . . . . 1 . . . . .\n        . . . . . . . . . . . .\n        . . . . . . . . . . . .\n    ",obstacle1:"\n        . . . . . . . . . . . . . . . . . . . . . .\n        . . . . . . . . . . 7 . . . . . . . . . . .\n        . . . . . . . . . . 7 7 . . . . . . . . . .\n        . . . . . . . . . 6 7 7 . . . . . . . . . .\n        . . . . . . . . 6 6 7 7 7 . . . . . . . . .\n        . . . . . . . . 6 6 7 7 7 . . . . . . . . .\n        . . . . . . . . 6 6 7 7 7 7 . . . . . . . .\n        . . . . . . . 6 6 7 7 7 7 7 . . . . . . . .\n        . . . . . . 6 6 6 7 7 7 7 7 . . . . . . . .\n        . . . . . . . . 6 6 6 6 6 . . . . . . . . .\n        . . . . . . . . 6 6 6 6 . . . . . . . . . .\n        . . . . . . . 6 6 6 6 6 7 7 . . . . . . . .\n        . . . . . . 6 6 6 7 7 7 7 7 7 . . . . . . .\n        . . . . . . 6 6 6 7 7 7 7 7 7 7 . . . . . .\n        . . . . . . 6 6 7 7 7 7 7 7 7 7 7 . . . . .\n        . . 6 6 6 6 6 7 7 7 7 7 7 7 7 7 7 7 7 . . .\n        . . . 6 6 6 6 6 7 7 7 7 7 6 6 6 6 6 . . . .\n        . . . . . . . . 6 6 6 6 7 7 . . . . . . . .\n        . . . . . . . . 6 6 6 7 7 7 . . . . . . . .\n        . . . . . . 6 6 7 7 7 7 7 7 7 . . . . . . .\n        . . . 6 6 6 7 7 7 7 7 7 7 7 7 7 7 . . . . .\n        6 6 6 6 7 7 7 7 7 7 7 7 7 7 7 7 7 7 . . . .\n        6 6 6 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 6\n        . . . 6 6 6 6 6 6 7 7 7 7 7 7 7 7 7 7 7 6 .\n        . . . . . 6 6 6 6 e e e e 7 7 7 7 7 6 6 6 .\n        . . . . . . . . . e e e e . . . . . . . . .\n        . . . . . . . . . e e e e . . . . . . . . .\n        . . . . . . . . . e e e e . . . . . . . . .\n        . . . . . . . 6 . e e e e . . 6 . . . . . .\n        . . . 6 6 6 . . . e e e e . 6 . . . . . . .\n        . . . 6 . 6 . . . e e e e . . . . . . . . .\n        . . . . . . . . . . . . . . . . . . . . . .\n   ",obstacle2:"\n        . . . . . . . . . . . . . . .\n        . . . . . . . . . . . . . . .\n        . . . . . . . . . . . . . . .\n        . . . . . . . . . . . . . . .\n        . . . . . . . . . . . . . . .\n        . . . . . . . . . . . . . . .\n        . . . . . . . . . . . . . . .\n        . . . . . . . . . . . . . . .\n        . . . . . . . . . . . . . . .\n        . . . . . . . . . . . . . . .\n        . . . . . . . . . . . . . . .\n        . . . . . . . . . . . . . . .\n        . . . . . . . . . . . . . . .\n        . . . . . . . . . . . . . . .\n        . . . . . . . . . . . . . . .\n        . . . . . . . . . . . . . . .\n        . . . . . . . . . . . . . . .\n        . . . . . . . . . . . . . . .\n        . . . . . e e e e e . . . . .\n        . . . . e e b b b e e . . . .\n        . . . e e b e e e b e e . . .\n        . . . e e b e e b b e e . . .\n        . . . . e e b b e e e . . . .\n        . . . e b e e e e b b e . . .\n        . . . e e b b b b e e e . . e\n        . . . e e e e e e e e . . e .\n        . . . e b e e b e b e . e . e\n        . . . e b e e e e b e e . . .\n        . . . e e e b e e e e . . . .\n        . . e e b e b e b e e e . . .\n        . e e e e e e e e e e e e . .\n        . . . . . . e e . . . . . . .\n   ",background:"\n   . . . . . . . . 1 1 1 1 1 1 1 1 . . . . . . . . . . . . . . . . .\n   . . . . . . . 1 1 1 1 1 1 1 1 1 1 . . . . . . . . . . . . . . . .\n   . . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . . . . . . . . . . . . .\n   . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . . . . . . . . . . . .\n   . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . . . . . .\n   . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . . . . .\n   . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . . . .\n   . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . . .\n   1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . . .\n   1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . .\n   . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . .\n   . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 .\n   . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1\n   . . . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1\n   . . . . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . .\n   . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .\n   "},ye={character:"Draw your character!",obstacle1:"Draw an obstacle!",obstacle2:"Draw another obstacle!",background:"Choose your background!"},ge=function(t){function e(t){var i;Object(c.a)(this,e),(i=Object(u.a)(this,Object(l.a)(e).call(this,t))).playBtn=void 0,i.spriteEditorHolder=void 0,i.spriteEditor=void 0,i.tabImages=void 0;var n=Object.keys(pe).map(function(t){var e=pe[t];return{data:Xt(function(t,e){for(var i="\n",n=0;n<e;n++)i+=".".repeat(t)+"\n";return i}(16,16)),name:t,callToAction:ye[t],default:te(e)}});return i.state={userImages:n,currentImg:0},i.tabImages=Object.keys(pe).map(function(t){return pe[t]}).map(te),i}return Object(f.a)(e,t),Object(h.a)(e,[{key:"renderSpriteEditor",value:function(){var t=this;if(this.spriteEditorHolder){var e=document.getElementsByTagName("body")[0],i=this.refs.header,n=(e.clientWidth-0)/539,a=(e.clientHeight-i.clientHeight-0)/465,s=Math.min(n,a);console.log("Sprite editor scale: ".concat(s));document.getElementsByTagName("html")[0];var o=this.state.userImages[this.state.currentImg].data;this.spriteEditor=new Gt(o,null,!1,s),this.spriteEditor.render(this.spriteEditorHolder),i.setAttribute("style","transform: scale(".concat(s,")"));var r=document.getElementsByClassName("sprite-editor-canvas"),c=!0,h=!1,u=void 0;try{for(var l,d=r[Symbol.iterator]();!(c=(l=d.next()).done);c=!0)l.value}catch(A){h=!0,u=A}finally{try{c||null==d.return||d.return()}finally{if(h)throw u}}var f=document.getElementsByClassName("sprite-canvas-controls"),v=!0,p=!1,y=void 0;try{for(var g,m=f[Symbol.iterator]();!(v=(g=m.next()).done);v=!0){var b=g.value,k=parseInt(b.getAttribute("width").replace("px","")),w=parseInt(b.getAttribute("height").replace("px","")),E=(k-0)/s,C=(w-0)/s;b.setAttribute("viewBox","".concat(0," ").concat(0," ").concat(E," ").concat(C))}}catch(A){p=!0,y=A}finally{try{v||null==m.return||m.return()}finally{if(p)throw y}}this.spriteEditor.rePaint(),this.spriteEditor.setActiveColor(1,!0),this.spriteEditor.setSizePresets([[8,8],[16,16],[32,32],[10,8]]),this.spriteEditorHolder.style.height=this.spriteEditor.outerHeight()+"px",this.spriteEditorHolder.style.width=this.spriteEditor.outerWidth()+"px",this.spriteEditorHolder.style.overflow="hidden",this.spriteEditorHolder.className="sprite-editor-container sprite-editor-dropdown-bg sprite-editor-dropdown",this.spriteEditor.addKeyListeners(),this.spriteEditor.onClose(function(){console.log("Closing sprite editor!"),t.onPlay()})}}},{key:"renderExperiments",value:function(){var t=Object(S.a)(L.a.mark(function t(){var e,i,n,a,s,o=this;return L.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=function(t){for(var e=/img`([\d\s\.a-f]*)`/gm,i=e.exec(t),n=[];null!=i;)n.push(i[1]),i=e.exec(t);return n},e=this.refs["tab-bar"],i=ie(20,20,64,64),e.TabBarSvg.appendChild(i),setInterval(function(){ne(i,o.spriteEditor.bitmap().image)},500),t.next=7,le("games/bunny_hop/main.ts");case 7:a=t.sent,s=n(a),s.map(te);case 10:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"renderGallery",value:function(){var t=Object(S.a)(L.a.mark(function t(){var e,i,n,a;return L.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:541,40,50,60,e=this.refs["sprite-gallery"],i=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","path"),a="M -".concat(40,",-").concat(40," l 0,").concat(40," l 0,").concat(10," l ").concat(40,",0 h ").concat(541," l ").concat(40,",0 l 0,-").concat(10," l 0,-").concat(40," z"),n.setAttribute("d",a),i.setAttribute("viewBox","0 0 ".concat(541," ").concat(60)),i.appendChild(n),e.appendChild(i);case 12:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"save",value:function(){var t=this;this.setState({userImages:this.state.userImages.map(function(e,i){return i===t.state.currentImg?(n=e,a=t.spriteEditor.bitmap().image,he("shareExperiment.mod.image"),{data:a,name:n.name,callToAction:n.callToAction,default:n.default}):e;var n,a})})}},{key:"load",value:function(t){var e=this.state.userImages[t].data;this.spriteEditor.bitmap().image=e,this.spriteEditor.rePaint()}},{key:"onTabChange",value:function(t){this.save(),this.setState({currentImg:t}),this.load(t),he("shareExperiment.mod.tabChange")}},{key:"render",value:function(){var t=this.state.userImages[this.state.currentImg];this.state.currentImg;return s.a.createElement("div",{className:"game-modder"},s.a.createElement("h1",{ref:"header"},t.callToAction),s.a.createElement(ce,{ref:"tab-bar",tabImages:this.tabImages,tabChange:this.onTabChange.bind(this)}),s.a.createElement("div",{ref:"sprite-editor-holder",className:"sprite-editor-holder"}),s.a.createElement("div",{ref:"sprite-gallery",className:"sprite-gallery"}),s.a.createElement("button",{ref:"play-btn"},"Play!"))}},{key:"componentDidMount",value:function(){var t=Object(S.a)(L.a.mark(function t(){return L.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.playBtn=this.refs["play-btn"],this.spriteEditorHolder=this.refs["sprite-editor-holder"],this.playBtn.addEventListener("click",this.onPlay.bind(this)),this.renderSpriteEditor(),t.next=6,this.renderGallery();case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.playBtn=void 0,this.spriteEditorHolder=void 0}},{key:"onPlay",value:function(){var t=Object(S.a)(L.a.mark(function t(){var e,i,n,a,s,o,r,c;return L.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=function(t,e){var i="e4101000".length,n="8704100010000000".length,a=$t(e.data);0==a.slice(i).replace(/0/g,"").length&&(a=$t(e.default));var s=$t(e.default).slice(i),o=t.indexOf(s)-n,r=t.indexOf('"',o),c=t.slice(o,r);return t.replace(c,a)},this.save(),t.next=4,le("games/bunny_hop/bin.js");case 4:for(i=t.sent,n=!0,a=!1,s=void 0,t.prev=8,o=this.state.userImages[Symbol.iterator]();!(n=(r=o.next()).done);n=!0)c=r.value,i=e(i,c);t.next=16;break;case 12:t.prev=12,t.t0=t.catch(8),a=!0,s=t.t0;case 16:t.prev=16,t.prev=17,n||null==o.return||o.return();case 19:if(t.prev=19,!a){t.next=22;break}throw s;case 22:return t.finish(19);case 23:return t.finish(16);case 24:this.props.playHandler(i);case 25:case"end":return t.stop()}},t,this,[[8,12,16,24],[17,,19,23]])}));return function(){return t.apply(this,arguments)}}()}]),e}(s.a.Component),me=(i(28),function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(l.a)(e).apply(this,arguments))}return Object(f.a)(e,t),Object(h.a)(e,[{key:"render",value:function(){var t=this.props.changeMode;return s.a.createElement("div",{className:"share-page"},s.a.createElement("div",{className:"share-header"},s.a.createElement("div",{className:"back-arrow-button",title:"Mod",role:"button",onClick:function(){return t("mod")}},s.a.createElement("div",{className:"back-arrow"}),s.a.createElement("div",{className:"back-arrow-label"},"Mod"))),s.a.createElement("h1",null,"Share your game!"),s.a.createElement("div",{className:"share-screenshot-container"},s.a.createElement("img",{className:"share-screenshot",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAB4CAYAAAB1ovlvAAAGuUlEQVR4Xu2dva4UNxSAZ58gBaKhS5EHICURImlSpEPiCVJDk44noIsUgVJQ8AARUrq0AXEvHfAAKVJBqhR5go28XF95vZ7x8fHxjGf22yarrH3m+PN3j392JXYf313sB14QqCRw6+0wDA+/KY6yQ8BiZnRIEEBAtFiUwJGAzy6Pcwkro//s6v9RARedtu08PFkBnWyxfNEyjYDbcWDRkZwIGFW6Q3JhZaQCLjpfm3v46B4wrIKJ91TAzamwzIAQcBnuPPWKwOghJL6a4RCCMy0IcA3TgioxxQQQUIyKhi0IHARUvDiEKKDRxY4AAtqxJJKCAAIqoNHFjgAC2rEkkoIAAiqg0cWOAALasSSSggACKqDRxY4AAtqxJJKCAAIqoNHFjgAC2rEkkoIAAiqg0cWOAALasSSSggACKqDRxY4AAtqxJJKCAAIqoNHFjgAC2rEkkoIAAiqg0cWOAALasSSSggACKqDRxY4AAtqxJJKCAAIqoNHFjgAC2rEkkoIAAiqg0cWOAALasSSSggACKqDRxY4AAtqxJJKCAAIqoNHFjgAC2rEkkoIAAiqg0cWOAALasSSSggACKqDRxY4AAtqxJJKCAAIqoNHFjgAC2rE8iXTr6+N/O+3T++hfEGr47LWERsBGM4V8MrAIKONU3CoUkMo3jg8Bi9WSdUBAGScElHEqboWAMmQIKOMkbhXv/XxHluE0QgQUq0XDFgSqBPR/7e6vO3zfIlFibpNAvYDPLodPd4bPAl693yYqRtWCQJWALqFQPCRsMUXbjomA257f7kdXJSAnvu7nt/sE1QKOyce1Q/dz3lWCJgLudrthv98fBubfc+/V1Tx3m4yJgKnRIWC3c95VYmYCusrnXr4SImBX89xtMmoBr69gEkNbi3x//vHX8N0PX3U7OeeQmErA3AFkLQcRBFxecQSkAi5qoUrAMOO1/vLXVT//YhlezsGzFxD5lpPvcG338d3F5ws85WuNFTCsfm7YSKicfINuZydgLB/LsIFFFSGqBQyvY9Zy/eJy9iJS/SrsMehqIqCXcC0CsgQbmGMUwkxAo3yah2EJbo646AFnJeCYfOwDi5wxbXw2AsZ7PiqhqUfqYGcjYEhobA/I5bTaI3XHsxSQU7DaF/OOVQI+/eLn4dF/P5kn1Togp+DWhOXxqwV0j1qThOz95HLM0VIt4L0Pfw8Pvv39kONaBEzJ5y6iuZSeQ7X0M1QCOvncywu4BglzVzBcxSwj4eYFTO33pmTkq7l5RTQTsLcqOLbchifgEHW4FFMN55OwWMDU8uvTXcNeUHII4T6wUwG9fPH+by0C5vaBLL/zieefVFwBXcdQRB/o9e0v58++4IlTlY9TcAFI46YmAvYqX67ipVhSBY0Ny4QrFjBV/Xq7D8zt83InYyScT8IiAXN7wJ5OwiWnYISbT7j4SeYC9iRhCit3gMvJlnqySsDwG5Cx4fR4JSPZE1IN5xV0UsCp/Z40zR5ERDzpbM3fLlsBpRK+fHX/JPulT8cS8XLIqYg5QnWfZwVMhY+l7O0U7HJGvjox5updLWDNL2JePn58Ms4HT55Ujz13zcL9XzViswBFAk59D+wzku75vHw37v54PZh/37w4vK+RcOxbDUlFZLk180ocaPfL93f3UxMuuftLPW1KxFA+L52L4WS0kDDMRyJenD8iiv2pbpgUcGyPV/q0MQlTAvpKWCugRripcSFj6ayXtU8uwdqqN/Vod0oOT8XxEhxWQu0SbC1fOJ5aEV1utTHKpnYdrYuW4HBIksto3z4lX7jc+nZhFSyVMCdfOPm5ti6fWlli4XIC5j73jKTt5tDPIpcjAV1VGpv4eFl+9NvzozH+8+vNkzGHd4NT1c93TFXBqZymIOfgtP7RKQLK/gSul+DSiY6vUEoqVur65ai6Xl3FlOaUOnz4n9rHFW0OAX0lzf3eMPd5ybhk027TKsw79wc/9sSDgH6iSya8VsBwCfbv/X+dzJqcSiYKAeslNBEwdw0zlqalgOEesPYUXI+VCHMSKLqIdom5vaDbz40J6D+fPBEH34CkDiMly/mcsHiWPYGiU3DqIOFTctKUyBcvu7GISGg/2T1GPAjoEps6/TrxYrk0S3Du8BEDQsIelbHNqXgJtn38cL2UI5s12XXEW1zAdWAiy1YEELAVWeKKCCCgCBONWhFAwFZkiSsigIAiTDRqRQABW5ElrogAAoow0agVAQRsRZa4IgIIKMJEo1YEELAVWeKKCCCgCBONWhFAwFZkiSsigIAiTDRqRQABW5ElrogAAoow0agVgf8BC0s2s6EX6osAAAAASUVORK5CYII="})),s.a.createElement("div",{className:"share-legal-text"},"You need to publish your project to share it. You acknowledge having consent to publish this project."),s.a.createElement("div",{className:"publish-action"},s.a.createElement("button",{className:"publish-button"},"Publish Project")))}}]),e}(s.a.Component)),be=function(t){function e(t){var i;return Object(c.a)(this,e),(i=Object(u.a)(this,Object(l.a)(e).call(this,t))).changeMode=function(t){i.setState({mode:t})},i.state={mode:"mod"},i.playGame=i.playGame.bind(Object(d.a)(i)),function(t){var e=window.appInsights||function(t){function e(t){a[t]=function(){var e=arguments;a.queue.push(function(){a[t].apply(a,e)})}}var i,n,a={config:t},s=document,o=window,r="script",c="AuthenticatedUserContext",h="start",u="stop",l="Track",d=l+"Event",f=l+"Page",v=s.createElement(r);v.src=t.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js",s.getElementsByTagName(r)[0].parentNode.appendChild(v);try{a.cookie=s.cookie}catch(p){}for(a.queue=[],a.version="1.0",i=["Event","Exception","Metric","PageView","Trace","Dependency"];i.length;)e("track"+i.pop());return e("set"+c),e("clear"+c),e(h+d),e(u+d),e(h+f),e(u+f),e("flush"),t.disableExceptionTracking||(e("_"+(i="onerror")),n=o[i],o[i]=function(t,e,s,o,r){var c=n&&n(t,e,s,o,r);return!0!==c&&a["_"+i](t,e,s,o,r),c}),a}({instrumentationKey:"9801ed01-c40f-46ec-aa40-2a1742a9e71c",disableAjaxTracking:!0,overridePageViewDuration:!1,disableExceptionTracking:!0,isCookieUseDisabled:!t,isStorageUseDisabled:!t,url:"https://pxt.azureedge.net/blob/dd22520c096be24e7432f5b46e8aad59711f31f0/ai.0.js"});function i(t){return t.replace(/(?:\d{5}-\d{5}-\d{5}-\d{5})|(?:_[0-9a-zA-Z]{12})/g,"xxxxx-xxxxx-xxxxx-xxxxx")}window.appInsights=e,ue()||(e.queue.push(function(){e.context.addTelemetryInitializer(function(e){var i=e.data.baseData;i.properties=i.properties||{},i.properties.target="arcade",i.properties.cookie=t})}),e.trackPageView(null,i(window.location.toString()),{urlReferrer:i(document.referrer.toString())}))}(!1),he("shareExperiment.landing"),i}return Object(f.a)(e,t),Object(h.a)(e,[{key:"render",value:function(){return s.a.createElement("div",{className:"App"},"mod"===this.state.mode?s.a.createElement(ge,{playHandler:this.playGame,changeMode:this.changeMode}):"play"===this.state.mode?s.a.createElement(j,{binJs:fe,changeMode:this.changeMode}):s.a.createElement(me,{changeMode:this.changeMode}))}},{key:"playGame",value:function(t){fe=t,ve=Date.now(),this.setState({mode:"play"}),he("shareExperiment.play")}},{key:"modGame",value:function(){ve&&(he("shareExperiment.playtime",{duration:Date.now()-ve}),ve=null),this.setState({mode:"mod"}),he("shareExperiment.mod")}}]),e}(s.a.Component);r.a.render(s.a.createElement(be,null),document.getElementById("root"))}],[[13,1,2]]]);
//# sourceMappingURL=main.02035978.chunk.js.map