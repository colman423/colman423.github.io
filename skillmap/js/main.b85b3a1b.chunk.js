(window.webpackJsonpskillsmap=window.webpackJsonpskillsmap||[]).push([[0],{24:function(e,t,a){e.exports=a(43)},36:function(e,t,a){},37:function(e,t,a){},38:function(e,t,a){},39:function(e,t,a){},40:function(e,t,a){},41:function(e,t,a){},42:function(e,t,a){},43:function(e,t,a){"use strict";a.r(t);var r,n,i=a(0),c=a.n(i),o=a(19),s=a.n(o),l=a(9),d=a(13),u=a(7),p=a(1),m=a(2),v=a.n(m),h=a(8),f="https://www.makecode.com/api/md";function b(e){var t={cmd:"",arg:""},a=/^(\w+)(:([:./\-+=\w]+))?/.exec((e||window.location.hash).replace(/^#/,""));return a&&(t={cmd:a[1],arg:a[3]||""}),t}function y(){var e={},t=window.location.search;t&&new URLSearchParams(t).forEach((function(t,a){"true"!==t.toLowerCase()&&"1"!==t||(t="true"),e[a]=t}));return e}function g(e,t){return O.apply(this,arguments)}function O(){return(O=Object(h.a)(v.a.mark((function e(t,a){var r,n,i,c,o;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&a){e.next=2;break}return e.abrupt("return",void 0);case 2:i="unknown",e.t0=t,e.next="docs"===e.t0?6:"github"===e.t0?11:14;break;case 6:return a=a.trim().replace(/^[\\/]/i,"").replace(/\.md$/i,""),c=(null===(r=window.pxtTargetBundle)||void 0===r?void 0:r.name)||"arcade",n="".concat(f,"/").concat(c,"/").concat(a),i="approved",e.abrupt("break",16);case 11:return e.next=13,k(a);case 13:return e.abrupt("return",e.sent);case 14:return n=a,e.abrupt("break",16);case 16:return e.next=18,I(n);case 18:return o=e.sent,e.abrupt("return",{text:o,identifier:n,status:i});case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return E.apply(this,arguments)}function E(){return(E=Object(h.a)(v.a.mark((function e(t){var a,r,n,i,c,o,s,l;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=pxt.github.parseRepoId(t),e.next=3,pxt.packagesConfigAsync();case 3:r=e.sent,n=pxt.github.repoStatus(a,r),i="unknown",e.t0=n,e.next=e.t0===pxt.github.GitRepoStatus.Banned?9:e.t0===pxt.github.GitRepoStatus.Approved?12:15;break;case 9:return i="banned",c="https://github.com/"+a.fullName,e.abrupt("break",17);case 12:return i="approved",c=void 0,e.abrupt("break",17);case 15:return c="https://github.com/"+a.fullName,e.abrupt("break",17);case 17:if(e.t1=a.tag,e.t1){e.next=22;break}return e.next=21,pxt.github.latestVersionAsync(a.slug,r,!0);case 21:e.t1=e.sent;case 22:if(o=e.t1){e.next=26;break}return pxt.log("skillmap github tag not found at ".concat(a.fullName)),e.abrupt("return",void 0);case 26:return a.tag=o,e.next=29,pxt.github.downloadPackageAsync("".concat(a.slug,"#").concat(a.tag),r);case 29:if(!(s=e.sent)){e.next=36;break}return l=(l=(l=(l=a.fileName||"skillmap").replace(/^\/?blob\/main\//,"")).replace(/^\/?blob\/master\//,"")).replace(/\.md$/,""),e.abrupt("return",{text:pxt.tutorial.resolveLocalizedMarkdown(a,s.files,l),identifier:a.fullName+"#"+l,reportId:c,status:i});case 36:return e.abrupt("return",void 0);case 37:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(){return(S=Object(h.a)(v.a.mark((function e(t,a){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,j("/api/".concat(encodeURIComponent(t),"/abusereports"),a);case 3:return e.abrupt("return");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return new Promise((function(t,a){var r=new XMLHttpRequest;r.addEventListener("error",(function(e){a(e)})),r.addEventListener("load",(function(){try{t(r.responseText)}catch(e){a(e)}})),r.open("GET",e),r.send()}))}function j(e,t){return new Promise((function(a,r){var n=new XMLHttpRequest;n.addEventListener("error",(function(e){r(e)})),n.addEventListener("load",(function(){try{a(n.responseText)}catch(e){r(e)}})),n.open("POST",e,!0),n.setRequestHeader("Content-type","application/json"),n.send(JSON.stringify(t))}))}function C(){var e=new Uint8Array(4);return function(e){if(window.crypto)window.crypto.getRandomValues(e);else for(var t=0;t<e.length;++t)e[t]=Math.floor(255*Math.random())}(e),new Uint32Array(e.buffer)[0]}function w(){function e(){return(65536|C()).toString(16).slice(-4)}return e()+e()+"-"+e()+"-4"+e().slice(-3)+"-"+e()+"-"+e()+e()+e()}function x(){return"localhost"===window.location.hostname}function A(e){return"".concat(x()?"":"/static/skillmap","/").concat(e.replace(/^\//,""))}function T(e){n=e}function N(e,t){var a,i;(t=t||{}).page=n,t.pageTitle=r,null===(a=(i=window).pxtTickEvent)||void 0===a||a.call(i,e,t)}var U=a(10);function R(e,t,a,r){return!Object.keys(null===a||void 0===a?void 0:a.activities).some((function(n){var i,c;return!(null===(i=P(e,t,a.mapId))||void 0===i||null===(c=i.activityState[n])||void 0===c?void 0:c.isCompleted)&&n!==r}))}function L(e,t,a,r){var n;return!!(null===(n=D(e,t,a,r))||void 0===n?void 0:n.isCompleted)}function M(e,t,a){var r,n=Object(U.a)(t.prerequisites);try{for(n.s();!(r=n.n()).done;){var i=r.value;if("tag"===i.type){if(!e.completedTags[a])return!1;var c=e.completedTags[a][i.tag];if(void 0===c||c<i.numberCompleted)return!1}else if("map"===i.type&&!R(e,a,t))return!1}}catch(o){n.e(o)}finally{n.f()}return!0}function _(e,t,a){var r,n={},i=Object(U.a)(a);try{for(i.s();!(r=i.n()).done;)for(var c=r.value,o=0,s=Object.keys(c.activities);o<s.length;o++){var l=s[o],d=c.activities[l];if(L(e,t,c.mapId,d.activityId)){var u,p=Object(U.a)(d.tags);try{for(p.s();!(u=p.n()).done;){var m=u.value;n[m]||(n[m]=0),n[m]++}}catch(v){p.e(v)}finally{p.f()}}}}catch(v){i.e(v)}finally{i.f()}return n}function P(e,t,a){return e.mapProgress[t]?e.mapProgress[t][a]:void 0}function D(e,t,a,r){var n;return null===(n=P(e,t,a))||void 0===n?void 0:n.activityState[r]}function V(e,t,a,r){var n=pxt.semver.parse(e.version||"0.0.0"),i=pxt.semver.parse(t),c=e;if(0===pxt.semver.cmp(n,i))return c;if(0===pxt.semver.cmp(n,pxt.semver.parse("0.0.0"))){var o=(null===e||void 0===e?void 0:e.mapProgress)&&Object.keys(null===e||void 0===e?void 0:e.mapProgress);if((null===o||void 0===o?void 0:o.length)>0&&e.mapProgress[o[0]].activityState){var s=e,l={};Object.keys(r).forEach((function(e){s.mapProgress[e]&&(l[e]=s.mapProgress[e])})),c=Object(p.a)(Object(p.a)({},s),{},{mapProgress:Object(u.a)({},a,l)})}}return c}var H={title:lf("Game Maker Guide"),description:lf("Level up your game making skills by completing the tutorials in this guide."),pageSourceStatus:"unknown",pageSourceUrl:"default",user:{version:pxt.skillmap.USER_VERSION,isDebug:!0,id:w(),mapProgress:{},completedTags:{}},maps:{}};function W(e,t,a,r,n,i,c){var o,s,l,d=arguments.length>7&&void 0!==arguments[7]&&arguments[7],m=a.mapId,v=D(e,t,m,r);v||(v={isCompleted:!1,activityId:r,currentStep:i,maxSteps:c,headerId:n});var h=R(e,t,a,r)&&!v.isCompleted&&d,f=(null===(o=e.mapProgress)||void 0===o?void 0:o[t])||{};return Object(p.a)(Object(p.a)({},e),{},{mapProgress:Object(p.a)(Object(p.a)({},e.mapProgress),{},Object(u.a)({},t,Object(p.a)(Object(p.a)({},f),{},Object(u.a)({},m,Object(p.a)(Object(p.a)({},(null===f||void 0===f?void 0:f[m])||{mapId:m}),{},{activityState:Object(p.a)(Object(p.a)({},(null===f||void 0===f||null===(s=f[m])||void 0===s?void 0:s.activityState)||{}),{},Object(u.a)({},r,Object(p.a)(Object(p.a)({},v),{},{headerId:n,currentStep:i,maxSteps:c,isCompleted:v.isCompleted||d}))),completionState:h?"transitioning":null===f||void 0===f||null===(l=f[m])||void 0===l?void 0:l.completionState})))))})}function B(e,t,a,r){var n,i,c,o=a.mapId,s=D(e,t,o,r);s||(s={isCompleted:!1,activityId:r,headerId:"",currentStep:0});var l=R(e,t,a,r)&&!s.isCompleted,d=(null===(n=e.mapProgress)||void 0===n?void 0:n[t])||{};return Object(p.a)(Object(p.a)({},e),{},{mapProgress:Object(p.a)(Object(p.a)({},e.mapProgress),{},Object(u.a)({},t,Object(p.a)(Object(p.a)({},d),{},Object(u.a)({},o,Object(p.a)(Object(p.a)({},(null===d||void 0===d?void 0:d[o])||{mapId:o}),{},{activityState:Object(p.a)(Object(p.a)({},(null===d||void 0===d||null===(i=d[o])||void 0===i?void 0:i.activityState)||{}),{},Object(u.a)({},r,Object(p.a)(Object(p.a)({},s),{},{isCompleted:!0}))),completionState:l?"transitioning":null===d||void 0===d||null===(c=d[o])||void 0===c?void 0:c.completionState})))))})}var q,G,F=function(){var e,t,a,r,n,i,c,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H,s=arguments.length>1?arguments[1]:void 0;switch(s.type){case"ADD_SKILL_MAP":return Object(p.a)(Object(p.a)({},o),{},{user:Object(p.a)(Object(p.a)({},o.user),{},{mapProgress:Object(p.a)(Object(p.a)({},o.user.mapProgress),{},Object(u.a)({},o.pageSourceUrl,Object(p.a)(Object(p.a)({},null===(e=o.user.mapProgress)||void 0===e?void 0:e[o.pageSourceUrl]),{},Object(u.a)({},s.map.mapId,{completionState:"incomplete",mapId:s.map.mapId,activityState:{}}))))}),maps:Object(p.a)(Object(p.a)({},o.maps),{},Object(u.a)({},s.map.mapId,s.map))});case"CLEAR_SKILL_MAPS":return Object(p.a)(Object(p.a)({},o),{},{maps:{}});case"CHANGE_SELECTED_ITEM":return Object(p.a)(Object(p.a)({},o),{},{selectedItem:s.id});case"SET_SKILL_MAP_COMPLETED":return Object(p.a)(Object(p.a)({},o),{},{user:Object(p.a)(Object(p.a)({},o.user),{},{mapProgress:Object(p.a)(Object(p.a)({},o.user.mapProgress),{},Object(u.a)({},o.pageSourceUrl,Object(p.a)(Object(p.a)({},null===(t=o.user.mapProgress)||void 0===t?void 0:t[o.pageSourceUrl]),{},Object(u.a)({},s.mapId,Object(p.a)(Object(p.a)({},null===(a=o.user.mapProgress)||void 0===a||null===(r=a[o.pageSourceUrl])||void 0===r?void 0:r[s.mapId]),{},{completionState:"completed"})))))})});case"OPEN_ACTIVITY":return Object(p.a)(Object(p.a)({},o),{},{editorView:{currentMapId:s.mapId,currentActivityId:s.activityId,state:"active",currentHeaderId:null===(n=D(o.user,o.pageSourceUrl,s.mapId,s.activityId))||void 0===n?void 0:n.headerId}});case"SAVE_AND_CLOSE_ACTIVITY":return Object(p.a)(Object(p.a)({},o),{},{editorView:Object(p.a)(Object(p.a)({},o.editorView),{},{state:"saving"})});case"CLOSE_ACTIVITY":return Object(p.a)(Object(p.a)({},o),{},{editorView:void 0,user:s.finished?B(o.user,o.pageSourceUrl,o.maps[o.editorView.currentMapId],o.editorView.currentActivityId):o.user});case"RESTART_ACTIVITY":return Object(p.a)(Object(p.a)({},o),{},{modal:void 0,editorView:{state:"active",currentMapId:s.mapId,currentActivityId:s.activityId},user:W(o.user,o.pageSourceUrl,o.maps[s.mapId],s.activityId)});case"SET_HEADERID_FOR_ACTIVITY":var l=(null===(i=o.editorView)||void 0===i?void 0:i.currentActivityId)===s.activityId&&(null===(c=o.editorView)||void 0===c?void 0:c.currentMapId)===s.mapId;return Object(p.a)(Object(p.a)({},o),{},{editorView:l?Object(p.a)(Object(p.a)({},o.editorView),{},{currentHeaderId:s.id}):o.editorView,user:W(o.user,o.pageSourceUrl,o.maps[s.mapId],s.activityId,s.id,s.currentStep,s.maxSteps)});case"SET_USER":return Object(p.a)(Object(p.a)({},o),{},{user:V(s.user,pxt.skillmap.USER_VERSION,o.pageSourceUrl,o.maps)});case"RESET_USER":return Object(p.a)(Object(p.a)({},o),{},{user:Object(p.a)(Object(p.a)({},o.user),{},{completedTags:{},mapProgress:{}})});case"UPDATE_USER_COMPLETED_TAGS":return o.pageSourceUrl?Object(p.a)(Object(p.a)({},o),{},{user:Object(p.a)(Object(p.a)({},o.user),{},{completedTags:Object(p.a)(Object(p.a)({},o.user.completedTags),{},Object(u.a)({},o.pageSourceUrl,_(o.user,o.pageSourceUrl,Object.keys(o.maps).map((function(e){return o.maps[e]})))))})}):o;case"SET_PAGE_TITLE":return Object(p.a)(Object(p.a)({},o),{},{title:s.title});case"SET_PAGE_DESCRIPTION":return Object(p.a)(Object(p.a)({},o),{},{description:s.description});case"SET_PAGE_INFO_URL":return Object(p.a)(Object(p.a)({},o),{},{infoUrl:s.infoUrl});case"SET_PAGE_SOURCE_URL":return Object(p.a)(Object(p.a)({},o),{},{pageSourceUrl:s.url,pageSourceStatus:s.status});case"SHOW_COMPLETION_MODAL":return Object(p.a)(Object(p.a)({},o),{},{modal:{type:"completion",currentMapId:s.mapId,currentActivityId:s.activityId}});case"SHOW_RESTART_ACTIVITY_MODAL":return Object(p.a)(Object(p.a)({},o),{},{modal:{type:"restart-warning",currentMapId:s.mapId,currentActivityId:s.activityId}});case"SHOW_REPORT_ABUSE_MODAL":return Object(p.a)(Object(p.a)({},o),{},{modal:{type:"report-abuse",currentMapId:s.mapId,currentActivityId:s.activityId}});case"SHOW_RESET_USER_MODAL":return Object(p.a)(Object(p.a)({},o),{},{modal:{type:"reset"}});case"HIDE_MODAL":return Object(p.a)(Object(p.a)({},o),{},{modal:void 0});default:return o}},Y=Object(d.b)(F),K=a(3),z=a(4),Q=a(6),$=a(5),J=a(23),X=function(e,t){return{type:"OPEN_ACTIVITY",mapId:e,activityId:t}},Z=function(){return{type:"SAVE_AND_CLOSE_ACTIVITY"}},ee=function(){return{type:"HIDE_MODAL"}},te=(a(36),function(e){Object(Q.a)(a,e);var t=Object($.a)(a);function a(e){var r;return Object(K.a)(this,a),(r=t.call(this,e)).handleOnClick=function(){r.setState({expanded:!r.state.expanded})},r.handleOnBlur=function(){r.setState({expanded:!1})},r.state={expanded:!1},r}return Object(z.a)(a,[{key:"getItemOnClick",value:function(e){return function(){return e.onClick(e.id)}}},{key:"render",value:function(){var e=this,t=this.props,a=t.icon,r=t.items,n=t.className,c=this.state.expanded;return i.createElement("div",{className:"dropdown ".concat(n," ").concat(c?"expanded":""),tabIndex:0,role:"button",onClick:this.handleOnClick,onBlur:this.handleOnBlur},i.createElement("i",{className:"icon ".concat(a)}),c&&i.createElement("div",{className:"dropdown-menu"},r.map((function(t,a){return i.createElement("div",{key:a,className:"dropdown-item",onClick:e.getItemOnClick(t),role:"menuitem"},t.label)}))))}}]),a}(i.Component));function ae(){return G||(q=new pxt.skillmap.IndexedDBWorkspace,G=q.initAsync().then((function(e){return q}))),G}function re(e){return ne.apply(this,arguments)}function ne(){return(ne=Object(h.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ae();case 2:return a=e.sent,e.abrupt("return",a.getProjectAsync(t));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ie(e){return ce.apply(this,arguments)}function ce(){return(ce=Object(h.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ae();case 2:return a=e.sent,e.next=5,a.saveProjectAsync(t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oe(){return se.apply(this,arguments)}function se(){return(se=Object(h.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ae();case 2:return t=e.sent,e.abrupt("return",t.getUserStateAsync());case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function le(e){return de.apply(this,arguments)}function de(){return(de=Object(h.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isDebug){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,ae();case 4:return a=e.sent,e.next=7,a.saveUserStateAsync(t);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a(37);var ue=x()?"http://localhost:3232/index.html":function(e){var t=/\/([\da-zA-Z\.]+)(?:--)?/i.exec(window.location.pathname);return"".concat(e.replace(/\/$/,""),"/").concat((null===t||void 0===t?void 0:t[1])||"")}(window.pxtTargetBundle.appTheme.embedUrl),pe=function(e){Object(Q.a)(a,e);var t=Object($.a)(a);function a(e){var r;return Object(K.a)(this,a),(r=t.call(this,e)).ref=void 0,r.messageQueue=[],r.finishedActivityState=void 0,r.nextId=0,r.pendingMessages={},r.handleFrameRef=function(e){if(e&&e.contentWindow){window.addEventListener("message",r.onMessageReceived),r.ref=e,r.ref.addEventListener("load",(function(){r.state.unloading&&(r.props.dispatchCloseActivity("finished"===r.finishedActivityState),r.props.dispatchUpdateUserCompletedTags(),r.finishedActivityState=void 0)})),me(".usabilla_live_button_container",!1),me("footer",!1);var t=document.getElementById("root");t&&pxt.BrowserUtils.addClass(t,"editor")}},r.onMessageReceived=function(e){var t=e.data;if("pxteditor"===t.type&&t.id&&r.pendingMessages[t.id])return r.onResponseReceived(r.pendingMessages[t.id],e.data),void delete r.pendingMessages[t.id];switch(t.action){case"event":r.handleEditorTickEvent(t);break;case"workspacesync":r.handleWorkspaceSyncRequest(t);break;case"workspacesave":r.handleWorkspaceSaveRequestAsync(t);break;case"workspaceevent":"createproject"===t.event.type&&r.handleWorkspaceReadyEventAsync()}},r.state={loaded:!1,unloading:!1},r}return Object(z.a)(a,[{key:"componentDidUpdate",value:function(){this.props.save&&this.sendMessage({type:"pxteditor",action:"saveproject",response:!1},!0)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("message",this.onMessageReceived),me(".usabilla_live_button_container",!0),me("footer",!0);var e=document.getElementById("root");e&&pxt.BrowserUtils.removeClass(e,"editor")}},{key:"render",value:function(){var e=this.props,t=e.url,a=e.title,r=e.save,n=this.state,c=n.loaded,o=n.unloading,s=r?lf("Saving..."):lf("Loading...");return i.createElement("div",{className:"makecode-frame-outer"},i.createElement("div",{className:"makecode-frame-loader ".concat(c&&!r?"hidden":"")},i.createElement("img",{src:A("assets/logo.svg"),alt:"MakeCode Logo"}),i.createElement("div",{className:"makecode-frame-loader-text"},s)),i.createElement("iframe",{className:"makecode-frame",src:o?"about:blank":t,title:a,ref:this.handleFrameRef}))}},{key:"onResponseReceived",value:function(e,t){var a=this.props.save;"saveproject"===e.action&&a&&("saving"===this.finishedActivityState?(this.finishedActivityState="finished",this.sendMessage({type:"pxteditor",action:"saveproject"},!0)):this.setState({unloading:!0})),"importproject"===e.action&&this.onEditorLoaded()}},{key:"sendMessage",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=function(e){a&&(e.response=!0,e.id=t.nextId+++"",t.pendingMessages[e.id]=e),t.ref.contentWindow.postMessage(e,"*")};if(this.ref)if(this.ref.contentWindow){for(;this.messageQueue.length;)r(this.messageQueue.shift());r(e)}else this.messageQueue.push(e)}},{key:"handleWorkspaceSyncRequest",value:function(e){this.sendMessage(Object(p.a)(Object(p.a)({},e),{},{success:!0,projects:[]}))}},{key:"handleWorkspaceSaveRequestAsync",value:function(){var e=Object(h.a)(v.a.mark((function e(t){var a,r,n,i,c,o,s,l,d,u,m,h,f;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.props,n=r.dispatchSetHeaderIdForActivity,i=r.activityHeaderId,c=r.activityType,o=r.title,s=r.mapId,l=r.activityId,d=Object(p.a)(Object(p.a)({},t.project),{},{header:Object(p.a)(Object(p.a)({},t.project.header),{},{id:i||t.project.header.id})}),(null===(a=d.header)||void 0===a?void 0:a.name)!==o&&(d.header.name=o,(u=d.text["pxt.json"])&&((m=JSON.parse(u)).name=o,d.text["pxt.json"]=pxt.Package.stringifyConfig(m))),!d.header.tutorialCompleted){e.next=8;break}return e.next=6,re(d.header.id);case 6:(null===(f=e.sent)||void 0===f||null===(h=f.header)||void 0===h?void 0:h.tutorial)&&(d.header.tutorial=f.header.tutorial,d.header.tutorial.tutorialStep=d.header.tutorialCompleted.steps-1,delete d.header.tutorialCompleted);case 8:if("tutorial"===c&&!d.header.tutorial&&!d.header.tutorialCompleted){e.next=11;break}return e.next=11,ie(d);case 11:d.header.tutorial?n(s,l,d.header.id,(d.header.tutorial.tutorialStep||0)+1,d.header.tutorial.tutorialStepInfo.length,!1):d.header.tutorialCompleted&&n(s,l,d.header.id,d.header.tutorialCompleted.steps,d.header.tutorialCompleted.steps,!0);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleWorkspaceReadyEventAsync",value:function(){var e=Object(h.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.activityHeaderId){e.next=7;break}return e.next=3,re(this.props.activityHeaderId);case 3:t=e.sent,this.sendMessage({type:"pxteditor",action:"importproject",project:t},!0),e.next=8;break;case 7:this.sendMessage({type:"pxteditor",action:"startactivity",path:this.props.tutorialPath,activityType:"tutorial"},!0);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleEditorTickEvent",value:function(e){switch(e.tick){case"tutorial.editorLoaded":this.onEditorLoaded();break;case"tutorial.complete":this.onTutorialFinished()}}},{key:"onEditorLoaded",value:function(){var e=this.props;N("skillmap.activity.loaded",{path:e.mapId,activity:e.activityId}),this.setState({loaded:!0})}},{key:"onTutorialFinished",value:function(){var e=this.props;N("skillmap.activity.complete",{path:e.mapId,activity:e.activityId}),this.finishedActivityState="saving",this.props.dispatchSaveAndCloseActivity()}}]),a}(i.Component);function me(e,t){var a=document.querySelector(e);(null===a||void 0===a?void 0:a.style)&&(a.style.display=t?"":"none")}var ve={dispatchSetHeaderIdForActivity:function(e,t,a,r,n,i){return{type:"SET_HEADERID_FOR_ACTIVITY",mapId:e,activityId:t,id:a,currentStep:r,maxSteps:n,isCompleted:i}},dispatchCloseActivity:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{type:"CLOSE_ACTIVITY",finished:e}},dispatchSaveAndCloseActivity:Z,dispatchUpdateUserCompletedTags:function(){return{type:"UPDATE_USER_COMPLETED_TAGS"}}},he=Object(l.b)((function(e,t){var a;if(!e||!e.editorView)return{};var r,n=e.editorView,i=n.currentActivityId,c=n.currentMapId,o=n.currentHeaderId,s=n.state,l=ue,d=e.maps[c].activities[i];return"/"!==ue.charAt(ue.length-1)||x()||(l=ue.substr(0,ue.length-1)),l+="?controller=1&skillsMap=1&noproject=1&nocookiebanner=1",r=d.displayName,{url:l,tutorialPath:d.url,title:r,mapId:c,activityId:i,activityHeaderId:o,completed:null===(a=D(e.user,e.pageSourceUrl,c,i))||void 0===a?void 0:a.isCompleted,activityType:d.type,save:"saving"===s}}),ve)(pe),fe=function(e){Object(Q.a)(a,e);var t=Object($.a)(a);function a(){var e;Object(K.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).reportAbuseUrl="https://github.com/contact/report-content",e.onBackClicked=function(){var t=e.props;N("skillmap.activity.back",{path:t.currentMapId||"",activity:t.currentActivityId||""}),e.props.dispatchSaveAndCloseActivity()},e.onSaveClicked=function(){var t=e.props,a=t.completedHeaderId;N("skillmap.export",{path:t.currentMapId||"",activity:t.currentActivityId||""}),window.open("".concat(ue,"#skillmapimport:").concat(a))},e}return Object(z.a)(a,[{key:"getSettingItems",value:function(){var e=this,t=[];return this.props.showReportAbuse&&t.push({id:"report",label:lf("Report Abuse"),onClick:function(t){N("skillmap.reportabuse"),window.open(e.reportAbuseUrl)}}),this.props.activityOpen||t.push({id:"reset",label:lf("Reset All"),onClick:function(){N("skillmap.reset.warning"),e.props.dispatchShowResetUserModal()}}),t}},{key:"render",value:function(){var e=this.props,t=e.activityOpen,a=e.completedHeaderId,r=this.getSettingItems();return i.createElement("div",{className:"header"},i.createElement("div",{className:"header-left"},t?i.createElement("i",{className:"icon arrow left",role:"button",onClick:this.onBackClicked}):i.createElement("div",{className:"header-logo"},i.createElement("img",{src:A("assets/logo.svg"),alt:"MakeCode Logo"}))),i.createElement("div",{className:"spacer"}),i.createElement("div",{className:"header-right"},a&&i.createElement("div",{className:"header-button",role:"button",onClick:this.onSaveClicked},lf("SAVE TO MY PROJECTS")),(null===r||void 0===r?void 0:r.length)>0&&i.createElement(te,{icon:"setting",className:"header-settings",items:r}),i.createElement("div",{className:"header-org-logo"},i.createElement("img",{src:A("assets/microsoft.png"),alt:"Microsoft Logo"}))))}}]),a}(i.Component);var be={dispatchSaveAndCloseActivity:Z,dispatchShowResetUserModal:function(){return{type:"SHOW_RESET_USER_MODAL"}}},ye=Object(l.b)((function(e,t){var a,r,n,i;if(!e)return{};(null===(a=e.editorView)||void 0===a?void 0:a.currentHeaderId)&&L(e.user,e.pageSourceUrl,e.editorView.currentMapId,e.editorView.currentActivityId)&&(i=e.editorView.currentHeaderId);var c=!!e.editorView;return{activityOpen:c,currentMapId:c&&(null===(r=e.editorView)||void 0===r?void 0:r.currentMapId),currentActivityId:c&&(null===(n=e.editorView)||void 0===n?void 0:n.currentActivityId),showReportAbuse:"unknown"===e.pageSourceStatus,completedHeaderId:i}}),be)(fe),ge=function(e){Object(Q.a)(a,e);var t=Object($.a)(a);function a(){return Object(K.a)(this,a),t.apply(this,arguments)}return Object(z.a)(a,[{key:"render",value:function(){var e=this.props,t=e.title,a=e.description,r=e.icon,n=e.infoUrl;return i.createElement("div",{className:"banner"},i.createElement("div",{className:"banner-card"},i.createElement("i",{className:"icon ".concat(r)}),i.createElement("div",{className:"banner-text"},i.createElement("div",{className:"banner-title"},i.createElement("span",null,t),n&&i.createElement("a",{className:"banner-info",href:n,target:"_blank",rel:"noopener noreferrer",role:"button"},i.createElement("i",{className:"icon info circle"}))),i.createElement("div",{className:"banner-description"},a))))}}]),a}(i.Component);var Oe=Object(l.b)((function(e,t){return{title:e.title,description:e.description,infoUrl:e.infoUrl}}))(ge),ke=(a(38),function(e){Object(Q.a)(a,e);var t=Object($.a)(a);function a(){var e;Object(K.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).handleModalClick=function(e){e.stopPropagation(),e.preventDefault()},e.handleCloseClick=function(){e.props.onClose&&e.props.onClose(),e.setState({visible:!1})},e}return Object(z.a)(a,[{key:"render",value:function(){var e=this.props,t=e.title,a=e.actions;return i.createElement("div",{className:"modal-overlay",onClick:this.handleCloseClick,role:"region"},i.createElement("div",{className:"modal",onClick:this.handleModalClick,role:"dialog"},i.createElement("div",{className:"modal-header"},i.createElement("div",{className:"modal-title"},t),i.createElement("div",{className:"spacer"}),i.createElement("div",{className:"modal-close-icon",onClick:this.handleCloseClick,role:"button"},i.createElement("i",{className:"icon close"}))),i.createElement("div",{className:"modal-body"},this.props.children),a&&a.length>0&&i.createElement("div",{className:"modal-actions"},a.map((function(e,t){return i.createElement("div",{key:t,className:"modal-button ".concat(e.className),onClick:e.onClick,role:"button"},e.label)})))))}}]),a}(i.Component)),Ee=function(e){Object(Q.a)(a,e);var t=Object($.a)(a);function a(){var e;Object(K.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).handleOnClose=function(){e.props.dispatchHideModal()},e}return Object(z.a)(a,[{key:"render",value:function(){var e=this.props,t=e.activity,a=e.type,r=e.completionType;switch(a){case"completion":return t||"map"===r?this.renderCompletionModal():i.createElement("div",null);case"restart-warning":return t?this.renderRestartWarning():i.createElement("div",null);case"report-abuse":return this.renderReportAbuse();case"reset":return this.renderResetWarning();default:return i.createElement("div",null)}}},{key:"renderCompletionModal",value:function(){var e=this.props,t=e.type,a=e.displayName,r=e.completionType,n=e.actions;if(!t)return i.createElement("div",null);var c="activity"===r?lf("Activity Complete!"):lf("Path Complete!"),o=lf("Good work! You've completed {0}. Collect your certificate and keep going!","{0}").split("{0}");return i.createElement("div",{className:"confetti-container"},i.createElement(ke,{title:c,actions:n,onClose:this.handleOnClose},o[0],i.createElement("strong",null,a),o[1]),Array(100).fill(0).map((function(e,t){var a={animationDelay:"".concat(t%100*.1,"s"),left:"".concat(1*Math.floor(100*Math.random()),"%")};return i.createElement("div",{key:t,style:a,className:"confetti ".concat(Math.random()>.5?"reverse":""," color-").concat(Math.floor(9*Math.random()))})})))}},{key:"renderRestartWarning",value:function(){var e=this.props,t=e.mapId,a=e.activity,r=e.dispatchRestartActivity,n=lf("Restart Activity?"),c=lf("Are you sure you want to restart {0}? You won't lose your path progress but the code have written for this activity will be deleted.","{0}").split("{0}"),o=[{label:lf("CANCEL"),onClick:this.handleOnClose},{label:lf("RESTART"),onClick:function(){N("skillmap.activity.restart",{path:t,activity:a.activityId}),r(t,a.activityId)}}];return i.createElement(ke,{title:n,actions:o,onClose:this.handleOnClose},c[0],i.createElement("strong",null,a.displayName),c[1])}},{key:"renderResetWarning",value:function(){var e=this.props,t=e.dispatchResetUser,a=e.dispatchHideModal,r=lf("Reset All Activities?"),n=lf("Are you sure you want to reset? This will permanently erase all progress and delete the project created for each tutorial. This action cannot be undone."),c=[{label:lf("CANCEL"),onClick:this.handleOnClose},{label:lf("RESET"),onClick:function(){N("skillmap.reset"),t(),a()}}];return i.createElement(ke,{title:r,actions:c,onClose:this.handleOnClose},n)}},{key:"renderReportAbuse",value:function(){var e=this.props,t=e.pageSourceUrl,a=e.dispatchHideModal,r=[{label:"REPORT",onClick:function(){N("skillmap.reportabuse"),function(e,t){S.apply(this,arguments)}(t||"",{text:document.querySelector(".report-abuse-text").value}),a()}}];return i.createElement(ke,{title:"Report Abuse",actions:r,onClose:this.handleOnClose},i.createElement("textarea",{className:"report-abuse-text",placeholder:"Describe the content and explain why you are reporting it for abuse. Provide as much detail as possible!"}))}}]),a}(i.Component);var Se={dispatchHideModal:ee,dispatchRestartActivity:function(e,t){return{type:"RESTART_ACTIVITY",mapId:e,activityId:t}},dispatchOpenActivity:X,dispatchResetUser:function(){return{type:"RESET_USER"}}},Ie=Object(l.b)((function(e,t){if(!e)return{};var a,r,n,i=e.pageSourceUrl,c=e.modal||{},o=c.currentMapId,s=c.currentActivityId,l=c.type,d=[];if(o&&"restart-warning"!==l){var u=e.maps[o];if(s){var p,m,v=u.activities[s];n="activity",r=v.displayName,a=null===(p=v.next)||void 0===p||null===(m=p[0])||void 0===m?void 0:m.activityId,d.push({label:lf("NEXT"),onClick:function(){N("skillmap.activity.next",{path:o,activity:s}),X(o,a||"")}})}else n="map",r=u.displayName,d.push({label:lf("CERTIFICATE"),onClick:function(){N("skillmap.certificate",{path:o}),window.open(u.completionUrl)}})}return{type:l,completionType:n,displayName:r,nextActivityId:a,pageSourceUrl:i,actions:d,mapId:o,activity:o&&s?e.maps[o].activities[s]:void 0}}),Se)(Ee);function je(e){var t=e.label;return i.createElement("span",null,t)}function Ce(e){var t=e.item,a=e.itemTemplate,r=e.selected,n=e.className,c=e.onSelect,o=a||je;return i.createElement("div",{className:"carousel-item ".concat(r?"selected":""," ").concat(n||""),onClick:function(){c&&c(t.id)},role:"group"},i.createElement(o,t))}a(39);var we=function(e){Object(Q.a)(a,e);var t=Object($.a)(a);function a(e){var r;return Object(K.a)(this,a),(r=t.call(this,e)).scrollMargin=5,r.carouselRef=void 0,r.scrollTo=function(e){r.carouselRef.scrollTo(e,0)},r.handleLeftArrowClick=function(){r.carouselRef.scrollBy({left:-window.innerWidth/2})},r.handleRightArrowClick=function(){r.carouselRef.scrollBy({left:window.innerWidth/2})},r.handleScroll=function(){var e=r.carouselRef.scrollLeft;r.setState({showLeft:e>r.scrollMargin,showRight:r.carouselRef.scrollWidth-r.carouselRef.clientWidth-e>r.scrollMargin})},r.handleRef=function(e){r.carouselRef=e},r.state={showLeft:!1,showRight:!0},r}return Object(z.a)(a,[{key:"componentDidMount",value:function(){this.handleScroll(),window.addEventListener("resize",this.handleScroll)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleScroll)}},{key:"render",value:function(){var e=this.props,t=e.title,a=e.items,r=e.selectedItem,n=e.itemTemplate,c=e.itemClassName,o=e.onItemSelect,s=e.prependChildren,l=e.appendChildren,d=e.titleIcon,u=e.titleDecoration,p=this.state,m=p.showLeft,v=p.showRight;return i.createElement("div",{className:"carousel"},t&&i.createElement("div",{className:"carousel-title"},d&&i.createElement("i",{className:"icon ".concat(d)}),i.createElement("span",null,t),u&&i.createElement("span",{className:"carousel-subtitle"},u)),m&&i.createElement("div",{className:"carousel-arrow left",onClick:this.handleLeftArrowClick,role:"button"},i.createElement("i",{className:"icon chevron left"})),i.createElement("div",{className:"carousel-items"},i.createElement("div",{className:"carousel-items-inner",onScroll:this.handleScroll,ref:this.handleRef},s,a.map((function(e,t){return i.createElement(Ce,{key:t,className:c,item:e,itemTemplate:n,selected:r===e.id,onSelect:o})})),l)),v&&i.createElement("div",{className:"carousel-arrow right",onClick:this.handleRightArrowClick,role:"button"},i.createElement("i",{className:"icon chevron right"})))}}]),a}(i.Component),xe=(a(40),function(e){Object(Q.a)(a,e);var t=Object($.a)(a);function a(){var e;Object(K.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).handleActionButtonClick=function(){var t=e.props,a=t.status,r=t.mapId,n=t.id,i=t.dispatchOpenActivity;switch(a){case"locked":break;case"completed":case"inprogress":case"notstarted":case"restarted":default:return N("skillmap.activity.open",{path:r,activity:n,status:a||""}),i(r,n)}},e.handleRestartButtonClick=function(){var t=e.props,a=t.mapId,r=t.id;(0,t.dispatchShowRestartActivityWarning)(a,r)},e}return Object(z.a)(a,[{key:"getSkillCardActionText",value:function(){switch(this.props.status){case"locked":return lf("LOCKED");case"completed":return lf("VIEW CODE");case"inprogress":case"restarted":return lf("CONTINUE");case"notstarted":default:return lf("START")}}},{key:"isCompleted",value:function(e){return"completed"===e||"restarted"===e}},{key:"render",value:function(){var e=this.props,t=e.label,a=e.description,r=e.imageUrl,n=e.tags,c=e.status,o=e.currentStep,s=e.maxSteps,l=this.isCompleted(c||"notstarted");return i.createElement("div",{className:"skill-card-container"},i.createElement("div",{className:"skill-card ".concat(c||"")},i.createElement("div",{className:"skill-card-display"},i.createElement("div",{className:"skill-card-image"},r?i.createElement("img",{src:r,alt:lf("Preview of activity content")}):i.createElement("i",{className:"icon ".concat("locked"!==c?"game":"")})),i.createElement("div",{className:"skill-card-label"},i.createElement("div",{className:"skill-card-title"},l&&i.createElement("i",{className:"icon check circle"}),"inprogress"===c&&s&&i.createElement("span",{className:"circular-label"},"".concat(o,"/").concat(s)),i.createElement("span",null,t)),i.createElement("div",{className:"skill-card-tags"},null===n||void 0===n?void 0:n.map((function(e,t){return i.createElement("div",{key:t},e)})))),"locked"===c&&i.createElement("div",{className:"skill-card-overlay"},i.createElement("i",{className:"icon lock"}))),i.createElement("div",{className:"skill-card-info"},i.createElement("div",{className:"skill-card-title"},t),i.createElement("div",{className:"skill-card-description"},a),i.createElement("div",{className:"spacer"}),i.createElement("div",{className:"skill-card-action"},l&&i.createElement("div",{className:"skill-card-button-icon",role:"button",onClick:this.handleRestartButtonClick},i.createElement("i",{className:"xicon redo"})),i.createElement("div",{className:"skill-card-button",role:"button",onClick:this.handleActionButtonClick},this.getSkillCardActionText())))))}}]),a}(i.Component));var Ae={dispatchOpenActivity:X,dispatchShowRestartActivityWarning:function(e,t){return{type:"SHOW_RESTART_ACTIVITY_MODAL",mapId:e,activityId:t}}},Te=Object(l.b)((function(e,t){var a,r,n,i=null===(a=e.maps)||void 0===a?void 0:a[t.mapId],c=e.user&&i&&function(e,t,a,r){return a.root.activityId===r||function n(i){if(L(e,t,a.mapId,i.activityId)){if(i.next.some((function(e){return e.activityId===r})))return!0;var c,o=Object(U.a)(i.next);try{for(o.s();!(c=o.n()).done;){var s=c.value;if(n(s))return!0}}catch(l){o.e(l)}finally{o.f()}}return!1}(a.root)}(e.user,e.pageSourceUrl,i,t.id)?"notstarted":"locked";if(e.user)if(i&&e.pageSourceUrl&&!M(e.user,i,e.pageSourceUrl))c="locked";else{var o=D(e.user,e.pageSourceUrl,t.mapId,t.id);o&&(o.isCompleted?c=o.currentStep&&o.maxSteps&&o.currentStep<o.maxSteps?"restarted":"completed":o.headerId&&(c="inprogress",r=null===o||void 0===o?void 0:o.currentStep,n=null===o||void 0===o?void 0:o.maxSteps))}return{status:c,currentStep:r,maxSteps:n}}),Ae)(xe),Ne=function(e){Object(Q.a)(a,e);var t=Object($.a)(a);function a(e){var r;return Object(K.a)(this,a),(r=t.call(this,e)).carouselRef=void 0,r.items=void 0,r.onItemSelect=function(e){var t=r.props,a=t.map,n=t.dispatchChangeSelectedItem;e!==r.props.selectedItem?(N("skillmap.carousel.item.select",{path:a.mapId,activity:e}),n(e)):(N("skillmap.carousel.item.deselect",{path:a.mapId,activity:e}),n(void 0))},r.handleEndCardClick=function(){var e=r.props,t=e.map,a=e.dispatchShowCompletionModal;N("skillmap.carousel.endcard.click",{path:t.mapId}),a(t.mapId)},r.handleEndCardTransition=function(){var e=r.props,t=e.map,a=e.dispatchShowCompletionModal;N("skillmap.carousel.endcard.auto",{path:t.mapId}),a(t.mapId)},r.handleCarouselRef=function(e){r.carouselRef=e},r.items=r.getItems(e.map.mapId,e.map.root),r}return Object(z.a)(a,[{key:"getItems",value:function(e,t){for(var a=[],r=t;r;)a.push({id:r.activityId,label:r.displayName,url:r.url,imageUrl:r.imageUrl,mapId:e,description:r.description,tags:r.tags}),r=r.next[0];return a}},{key:"getEndCard",value:function(e){var t=this.props.completionState;return i.createElement("div",{className:"end-card ".concat("completed"===t?"spin":""),key:"end"},i.createElement("div",{className:"end-card-icon",onClick:e?this.handleEndCardClick:void 0,role:"button"},"transitioning"===t||"completed"===t?i.createElement("i",{className:"icon trophy",onTransitionEnd:this.handleEndCardTransition}):i.createElement("div",{className:"end-card-placeholder"})))}},{key:"renderRequirements",value:function(){var e=this;if(this.props.pageSourceUrl){var t=this.props.map.prerequisites,a=this.props.user.completedTags,r=t.map((function(t){if("tag"===t.type){var r=t.numberCompleted;if(a[e.props.pageSourceUrl]&&a[e.props.pageSourceUrl][t.tag]&&(r=Math.max(r-a[e.props.pageSourceUrl][t.tag],0)),r)return i.createElement("span",{key:"tag_"+t.tag},r," ",i.createElement("span",{className:"carousel-subtitle-tag"},t.tag))}return null})).filter((function(e){return!!e})),n=this.props.requiredMaps.map((function(e){return i.createElement("span",{key:"map_"+e.mapId,className:"carousel-subtitle-map"},e.displayName)}));return r.length||n.length?n.length?r.length?Re(lf("Complete {0} tutorial(s) and the {1} map(s) to unlock!","{0}","{1}"),[Ue(r),Ue(n)]):Re(lf("Complete the {0} map(s) to unlock!","{0}"),[Ue(n)]):Re(lf("Complete {0} tutorial(s) to unlock!","{0}"),[Ue(r)]):void 0}}},{key:"componentDidUpdate",value:function(e){"transitioning"===e.completionState&&(this.carouselRef.scrollTo(1e4),setTimeout((function(){return e.dispatchSetSkillMapCompleted(e.map.mapId)}),400))}},{key:"render",value:function(){var e=this.props,t=e.map,a=e.user,r=e.selectedItem,n=R(a,e.pageSourceUrl,t),c=[this.getEndCard(n)],o=this.renderRequirements();return i.createElement(we,{title:t.displayName,items:this.items,itemTemplate:Te,itemClassName:"linked",onItemSelect:this.onItemSelect,selectedItem:r,appendChildren:c,titleIcon:o&&"lock",titleDecoration:o,ref:this.handleCarouselRef})}}]),a}(i.Component);function Ue(e){return e.length<=1?e[0]:2===e.length?i.createElement("span",null,e[0]," and ",e[1]):i.createElement("span",null,e.slice(0,e.length-1).map((function(e){return i.createElement("span",null,e,", ")}))," and ",e[e.length-1])}function Re(e,t){for(var a=[],r=e,n=0,c=0;c<t.length;c++){var o=r.split("{"+c+"}");a.push(i.createElement("span",{key:n++},o[0])),a.push(i.createElement("span",{key:n++},t[c])),r=r.substr(o[0].length+3)}return a.push(i.createElement("span",{key:n++},r)),i.createElement("span",null,a)}var Le={dispatchChangeSelectedItem:function(e){return{type:"CHANGE_SELECTED_ITEM",id:e}},dispatchShowCompletionModal:function(e,t){return{type:"SHOW_COMPLETION_MODAL",mapId:e,activityId:t}},dispatchSetSkillMapCompleted:function(e){return{type:"SET_SKILL_MAP_COMPLETED",mapId:e}}},Me=Object(l.b)((function(e,t){var a,r,n,i,c,o;if(!e)return{};var s=t.map,l=null===(a=e.user)||void 0===a||null===(r=a.mapProgress)||void 0===r?void 0:r[e.pageSourceUrl],d=[];return(null===(n=s.prerequisites)||void 0===n?void 0:n.length)&&e.pageSourceUrl&&(d=s.prerequisites.filter((function(t){return"map"===t.type&&!M(e.user,e.maps[t.mapId],e.pageSourceUrl)})).map((function(t){return e.maps[t.mapId]}))),{user:e.user,requiredMaps:d,pageSourceUrl:e.pageSourceUrl,completionState:null===l||void 0===l||null===(i=l[s.mapId])||void 0===i?void 0:i.completionState,selectedItem:e.selectedItem&&(null===(c=t.map)||void 0===c||null===(o=c.activities)||void 0===o?void 0:o[e.selectedItem])?e.selectedItem:void 0}}),Le)(Ne);function _e(e){for(var t,a,r=function(e){var t,a=e.split("\n"),r=[],n=null,i=null,c=null,o=Object(U.a)(a);try{for(o.s();!(t=o.n()).done;){var s=t.value;if(s.trim()){if(s.startsWith("#")){var l=/^(#+)\s*(.+)$/.exec(s);if(l){u(),n={headerKind:1===l[1].length?"single":2===l[1].length?"double":"triple",header:l[2],attributes:{}},i=null,c=null;continue}}if(n){var d=/^[*-]\s+(?:([^:]+):)?(.*)$/.exec(s);d&&(d[1]?(i&&c&&(n.attributes[i]=c.trim()),i=d[1].toLowerCase(),c=d[2]):i&&(c+=d[2]))}}else c&&(c+="\n")}}catch(p){o.e(p)}finally{o.f()}return u(),r;function u(){n&&(i&&c&&(n.attributes[i]=c.trim()),r.push(n))}}(e),n=[],i=-1,c=0;c<r.length;c++)"single"===r[c].headerKind?t={title:(a=r[c]).attributes.name||a.header,description:a.attributes.description,infoUrl:a.attributes.infourl}:"double"===r[c].headerKind&&(i>=0&&n.push(Pe(r[i],r.slice(i+1,c))),i=c);return(i>0||0===n.length)&&n.push(Pe(r[i],r.slice(i+1,r.length))),{maps:n,metadata:t}}function Pe(e,t){var a=function(e){var t={mapId:e.header.toLowerCase(),displayName:e.attributes.name||e.header,description:e.attributes.description,completionUrl:e.attributes.completionurl,prerequisites:[],activities:{}};if(e.attributes.required){var a,r=e.attributes.required.split(","),n=Object(U.a)(r);try{for(n.s();!(a=n.n()).done;){var i=a.value,c=/^\s*(?:(\d+) +)?(.+)$/.exec(i);c[1]?t.prerequisites.push({type:"tag",tag:c[2].trim(),numberCompleted:parseInt(c[1])}):t.prerequisites.push({type:"map",mapId:c[2].trim()})}}catch(o){n.e(o)}finally{n.f()}}return t}(e),r=t.map(De);a.root=r[0];var n,i=Object(U.a)(r);try{for(i.s();!(n=i.n()).done;){var c=n.value;a.activities[c.activityId]&&He("Duplicate activity id '".concat(c.activityId,"' in map '").concat(a.mapId,"'")),a.activities[c.activityId]=c}}catch(y){i.e(y)}finally{i.f()}var o,s=Object(U.a)(r);try{for(s.s();!(o=s.n()).done;){var l,d=o.value,u=Object(U.a)(d.nextIds);try{for(u.s();!(l=u.n()).done;){var m=l.value;a.activities[m]||He("Unknown activity id '".concat(m,"' in map '").concat(a.mapId,"'")),d.next.push(a.activities[m])}}catch(y){u.e(y)}finally{u.f()}}}catch(y){s.e(y)}finally{s.f()}var v={};!function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r[t.activityId]&&He("Loop in map '".concat(a.mapId,"' detected"));r[t.activityId]=!0,v[t.activityId]=!0,t.next.length>1&&He("Branching currently not supported");var n,i=Object(U.a)(t.next);try{for(i.s();!(n=i.n()).done;){var c=n.value;e(c,Object(p.a)({},r))}}catch(y){i.e(y)}finally{i.f()}}(a.root);var h,f=Object(U.a)(r);try{for(f.s();!(h=f.n()).done;){var b=h.value;v[b.activityId]||console.warn("Unreachable activity detected '".concat(b.activityId,"' in map '").concat(a.mapId,"'"))}}catch(y){f.e(y)}finally{f.f()}return a}function De(e){var t={activityId:e.header.toLowerCase(),displayName:e.attributes.name||e.header,description:e.attributes.description,url:e.attributes.url,imageUrl:e.attributes.imageurl,tags:Ve(e.attributes.tags),next:[],nextIds:Ve(e.attributes.next)};if(e.attributes.type){var a=e.attributes.type.toLowerCase();switch(a){case"tutorial":t.type=a}}if(e.attributes.editor){var r=e.attributes.editor.toLowerCase();switch(r){case"py":case"blocks":case"js":t.editor=r;break;default:t.editor="blocks"}}return t.url||He("Activity '".concat(t.activityId,"' is missing attribute 'url'")),t.type||He("Activity '".concat(t.activityId,"' is missing attribute 'type'")),t}function Ve(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return[];var a=e.split(",").map((function(e){return e.trim().toLowerCase()})).filter((function(e){return!!e}));if(!t){var r={};return a.forEach((function(e){return r[e]=e})),Object.keys(r)}return a}function He(e){throw e}a(41),a(42);window.Promise=J;var We=function(e){Object(Q.a)(a,e);var t=Object($.a)(a);function a(e){var r;return Object(K.a)(this,a),(r=t.call(this,e)).queryFlags={},r.unsubscribeChangeListener=void 0,r.loadedUser=void 0,r.handleHashChange=function(){var e=Object(h.a)(v.a.mark((function e(t){var a,n,i;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pxt.targetConfigAsync();case 2:n=e.sent,i=b(window.location.hash||(null===(a=n.skillMap)||void 0===a?void 0:a.defaultPath)),r.fetchAndParseSkillMaps(i.cmd,i.arg),t.stopPropagation(),t.preventDefault();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.handleError=function(e){var t=e||lf("Oops! Couldn't load content, please check the URL and markdown file.");console.error(t),r.setState({error:t})},r.onStoreChange=Object(h.a)(v.a.mark((function e(){var t,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Y.getState(),(a=t.user)===r.loadedUser||r.loadedUser&&a.id!==r.loadedUser.id){e.next=5;break}return e.next=4,le(a);case 4:r.loadedUser=a;case 5:case"end":return e.stop()}}),e)}))),r.state={},window.addEventListener("hashchange",r.handleHashChange),r}return Object(z.a)(a,[{key:"initLocalizationAsync",value:function(){var e=Object(h.a)(v.a.mark((function e(){var t,a,r,n,i,c,o,s;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=pxt.appTarget.appTheme,a=window.location.href,r=!1,n=void 0,/[&?]translate=1/.test(a)&&!pxt.BrowserUtils.isIE()?(console.log("translation mode"),n=ts.pxtc.Util.TRANSLATION_LOCALE):((i=/(live)?(force)?lang=([a-z]{2,}(-[A-Z]+)?)/i.exec(window.location.href))&&window.location.hash.indexOf(i[0])>=0&&pxt.BrowserUtils.changeHash(window.location.hash.replace(i[0],"")),n=i?i[3]:pxt.BrowserUtils.getCookieLang()||t.defaultLocale||navigator.userLanguage||navigator.language,r=!!i&&!!i[2]),"",c=pxt.appTarget.id,o=pxt.appTarget.versions.pxtCrowdinBranch,s=pxt.appTarget.versions.targetCrowdinBranch,e.next=11,Be(c,"",n,o,s,!0,r);case 11:pxt.Util.isLocaleEnabled(n)&&pxt.BrowserUtils.setCookieLang(n);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchAndParseSkillMaps",value:function(){var e=Object(h.a)(v.a.mark((function e(t,a){var n,i,c,o,s,l,d,u,p,m,h,f,b=this;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(t,a);case 2:if(n=e.sent,i=null===n||void 0===n?void 0:n.text,c=null===n||void 0===n?void 0:n.identifier,o=null===n||void 0===n?void 0:n.status,i&&c&&o)try{"banned"===o?this.handleError(lf("This GitHub repository has been banned.")):(T(c),this.props.dispatchSetPageSourceUrl(c,o)),l=_e(i),d=l.maps,u=l.metadata,(null===d||void 0===d?void 0:d.length)>0&&(s=d,this.props.dispatchClearSkillMaps(),d.forEach((function(e){b.props.dispatchAddSkillMap(e)}))),u&&(p=u.title,m=u.description,h=u.infoUrl,r=p,this.props.dispatchSetPageTitle(p),m&&this.props.dispatchSetPageDescription(m),h&&this.props.dispatchSetPageInfoUrl(h)),this.setState({error:void 0})}catch(v){this.handleError(v)}else this.setState({error:lf("No content loaded.")});return e.next=9,oe();case 9:(f=e.sent)||(f={id:w(),completedTags:{},mapProgress:{},version:pxt.skillmap.USER_VERSION}),c&&!f.completedTags[c]&&(f.completedTags[c]={}),this.applyQueryFlags(f,s),this.loadedUser=f,this.props.dispatchSetUser(f);case 15:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(h.a)(v.a.mark((function e(){var t,a,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.unsubscribeChangeListener=Y.subscribe(this.onStoreChange),this.queryFlags=y(),e.next=4,pxt.targetConfigAsync();case 4:return a=e.sent,r=b(window.location.hash||(null===(t=a.skillMap)||void 0===t?void 0:t.defaultPath)),e.next=8,this.initLocalizationAsync();case 8:this.fetchAndParseSkillMaps(r.cmd,r.arg);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){window.removeEventListener("hashchange",this.handleHashChange),this.unsubscribeChangeListener&&this.unsubscribeChangeListener()}},{key:"render",value:function(){var e=this.props,t=e.skillMaps,a=e.activityOpen,r=this.state.error,n=Object.keys(t).map((function(e){return t[e]}));return c.a.createElement("div",{className:"app-container ".concat(pxt.appTarget.id)},c.a.createElement(ye,null),a?c.a.createElement(he,null):c.a.createElement("div",null,c.a.createElement(Oe,{icon:"map"}),c.a.createElement("div",{className:"skill-map-container"},r?c.a.createElement("div",{className:"skill-map-error"},r):null===n||void 0===n?void 0:n.map((function(e,t){return c.a.createElement(Me,{map:e,key:t})})))),c.a.createElement(Ie,null))}},{key:"applyQueryFlags",value:function(e,t,a){var r=a||"default";if("true"===this.queryFlags.debugNewUser&&(e.isDebug=!0,e.mapProgress=Object(u.a)({},r,{}),e.completedTags={}),"true"===this.queryFlags.debugCompleted&&(e.isDebug=!0,t)){var n,i=Object(U.a)(t);try{for(i.s();!(n=i.n()).done;){var c=n.value;e.mapProgress[r][c.mapId]={completionState:"completed",mapId:c.mapId,activityState:{}};for(var o=0,s=Object.keys(c.activities);o<s.length;o++){var l,d=s[o],p=c.activities[d];if(e.mapProgress[r][c.mapId].activityState[p.activityId]?e.mapProgress[r][c.mapId].activityState[p.activityId].isCompleted=!0:e.mapProgress[r][c.mapId].activityState[p.activityId]={activityId:p.activityId,isCompleted:!0},(null===(l=p.tags)||void 0===l?void 0:l.length)&&a){var m,v=Object(U.a)(p.tags);try{for(v.s();!(m=v.n()).done;){var h=m.value;e.completedTags[a][h]||(e.completedTags[a][h]=0),e.completedTags[a][h]++}}catch(f){v.e(f)}finally{v.f()}}}}}catch(f){i.e(f)}finally{i.f()}}}}]),a}(c.a.Component);function Be(e,t,a,r,n,i,c){return qe.apply(this,arguments)}function qe(){return(qe=Object(h.a)(v.a.mark((function e(t,a,r,n,i,c,o){var s;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("en-US"===(r=pxt.Util.normalizeLanguageCode(r)[0])&&(r="en"),r!==pxt.Util.userLanguage()&&(pxt.Util.isLocaleEnabled(r)||o)){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,pxt.Util.downloadTranslationsAsync(t,a,r,n,i,!!c,ts.pxtc.Util.TranslationsKind.SkillMap);case 6:s=e.sent,pxt.Util.setUserLanguage(r),s&&(pxt.Util.setLocalizedStrings(s),c&&(pxt.Util.localizeLive=!0));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ge={dispatchAddSkillMap:function(e){return{type:"ADD_SKILL_MAP",map:e}},dispatchClearSkillMaps:function(){return{type:"CLEAR_SKILL_MAPS"}},dispatchSetPageTitle:function(e){return{type:"SET_PAGE_TITLE",title:e}},dispatchSetPageDescription:function(e){return{type:"SET_PAGE_DESCRIPTION",description:e}},dispatchSetPageInfoUrl:function(e){return{type:"SET_PAGE_INFO_URL",infoUrl:e}},dispatchSetUser:function(e){return{type:"SET_USER",user:e}},dispatchSetPageSourceUrl:function(e,t){return{type:"SET_PAGE_SOURCE_URL",url:e,status:t}}},Fe=Object(l.b)((function(e,t){return e?{skillMaps:e.maps,activityOpen:!!e.editorView}:{}}),Ge)(We),Ye=window.pxtTargetBundle;Ye.bundledpkgs={},pxt.setAppTarget(Ye),pxt.Cloud.apiRoot="https://www.makecode.com/api/",s.a.render(c.a.createElement(l.a,{store:Y},c.a.createElement(Fe,null)),document.getElementById("root"))}},[[24,1,2]]]);